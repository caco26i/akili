/*!
 * Akili is a javascript framework
 *
 * const Akili = makeItEasy(js + html);
 *
 * @version 1.2.21
 * @author Alexandr Balasyan <mywebstreet@gmail.com>
 * {@link http://akilijs.com}
 * {@link https://github.com/ortexx/akili}
 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Akili=e():t.Akili=e()}(self,(function(){return(()=>{"use strict";var t={d:(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},e={};function n(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){return(i=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function o(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function a(t,e,n){return(a=o()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var o=new(Function.bind.apply(t,r));return n&&i(o,n.prototype),o}).apply(null,arguments)}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function l(t){return function(t){if(Array.isArray(t))return s(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return s(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function c(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function h(t,e,n){return e&&c(t.prototype,e),n&&c(t,n),t}function _(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function f(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?_(Object(r),!0).forEach((function(e){n(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):_(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}t.d(e,{default:()=>Ft});var p=function(){function t(e,n,r,i){u(this,t),this.name=e,this.node=n,this.el=r,this.component=i}return h(t,[{key:"trigger",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.__removed||!n&&this.inEvaluating()||(t=m.copy(t,{plain:!0}),this.el.dispatchEvent(new CustomEvent(this.name,this.prepareOptions(f({detail:t},e)))))}},{key:"dispatch",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.__removed||!n&&this.inEvaluating()||this.el.dispatchEvent(new t(this.name,this.prepareOptions(e)))}},{key:"prepareOptions",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t=f({bubbles:!0},t),this.node.__component.__prepareAttributeOut(this.node,t.detail),t}},{key:"inEvaluating",value:function(){var t=this.component.__evaluatingEvent;return!!t&&(t.el===this.el&&t.event.type===this.name&&t.component===this.component)}},{key:"bind",value:function(t){this.el.addEventListener(this.name,this.fn=t)}},{key:"unbind",value:function(){this.fn&&this.el.removeEventListener(this.name,this.fn)}},{key:"remove",value:function(){this.unbind(),delete this.name,delete this.node,delete this.component,delete this.el,this.__removed=!0}}]),t}();function v(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function d(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?v(Object(r),!0).forEach((function(e){n(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):v(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var y={class:function(t){if(!t||"object"!==r(t))return"";for(var e=[],n=Object.keys(t),i=0,o=n.length;i<o;i++){var a=n[i];t[a]&&e.push(a)}return e.join(" ")},style:function(t){if(!t||"object"!==r(t))return"";for(var e=[],n=Object.keys(t),i=0,o=n.length;i<o;i++){var a=n[i],s=t[a];s&&e.push("".concat(this.toDashCase(a),":").concat(s))}return e.join(";")},split:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=[],i="";if(!e)return t.split("");if(e instanceof RegExp)return t.split(e);if(-1==t.indexOf(e))i=t;else for(var o=t.split(""),a="",s=0,l=o.length;s<l;s++){var u=o[s],c=n.indexOf(u);c>-1&&(!a||a==u)&&(a=a?"":n[c]),u!=e||a?i+=u:(r.push(i),i="")}return i&&r.push(i),r},filter:function(t,e){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=[];if(r&&!Array.isArray(r)&&(r=[r]),"function"!=typeof e){var o=e?(e+"").toLowerCase():"";e=function(t){return(t?(t+"").toLowerCase():"").match(n.escapeForRegExp(o))}}for(var a=0,s=t.length;a<s;a++){var l=t[a],u=!1;if(!r&&e(l))u=!0;else if(r)for(var c=0,h=r.length;c<h;c++){var _=r[c],f=(_=Array.isArray(_)?_:[_])?this.getPropertyByKeys(_,l):l;e(f)&&(u=!0)}u&&i.push(l)}return i},sort:function(t){var e=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];t=t.slice(),!0===n?(n=[],r=[!0]):!1===n&&(n=[],r=[!1]),Array.isArray(n)||(n=[n]),Array.isArray(r)||(r=[r]);var i=n.length;return t.sort((function(t,o){var a=0,s=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return t instanceof Date&&(t=t.getTime()),e instanceof Date&&(e=e.getTime()),t>e?n?-1:1:t<e?n?1:-1:0};return i?function l(){if(a>=i)return 0;var u=n[a];Array.isArray(u)||(u=[u]);var c=e.getPropertyByKeys(u,t),h=e.getPropertyByKeys(u,o),_=s(c,h,!1===r[a]);return 0!==_?_:(a++,l())}():s(t,o,!1===r[a])})),t},includeKeys:function(t,e){for(var n={},r=Object.keys(t),i=0,o=r.length;i<o;i++){var a=r[i];-1!=e.indexOf(a)&&(n[a]=t[a])}return n},excludeKeys:function(t,e){for(var n={},r=Object.keys(t),i=0,o=r.length;i<o;i++){var a=r[i];-1==e.indexOf(a)&&(n[a]=t[a])}return n},isScopeProxy:function(t){return!(!t||"object"!=r(t)||!t.__isProxy)},isStoreProxy:function(t){return!(!t||"object"!=r(t)||!t.__isProxy||t.__component)},isPlainObject:function(t){return!(!t||"object"!=r(t)||t.constructor!=Object&&t.constructor!=Array)},copy:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("object"!=r(t)||!t)return t;n=d({nested:!0,enumerable:!0,plain:!1},n);var i=function t(i){if(i=e.isScopeProxy(i)||e.isStoreProxy(i)?i.__target:i,n.plain&&!e.isPlainObject(i))return i;for(var o=n.enumerable?Object.keys(i):Object.getOwnPropertyNames(i),a=Array.isArray(i)?[]:{},s=0,l=o.length;s<l;s++){var u=o[s],c=i[u];c=c&&"object"==r(c)&&n.nested?t(c):c,Object.prototype.propertyIsEnumerable.call(i,u)?a[u]=c:Object.defineProperty(a,u,d(d({},Object.getOwnPropertyDescriptor(i,u)),{},{value:c}))}return a};return i(t)},makeAttributeValue:function(t){return!1===t||null==t?"":t instanceof p?"[object Event]":"function"==typeof t?"[object Function]":"object"==r(t)?Object.prototype.toString.call(t):t+""},compare:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(t instanceof Date&&e instanceof Date)return t.getTime()===e.getTime();if("function"==typeof t&&"function"==typeof e)return t.toString()===e.toString();if("object"==r(t)&&"object"==r(e)){if(null===t||null===e)return t===e;var i=function(t){for(var e=Array.isArray(t)?[]:{},r=n.enumerable?Object.keys(t):Object.getOwnPropertyNames(),i=0,o=r.length;i<o;i++){var a=r[i];void 0!==t[a]&&(e[a]=t[a])}return e};(n=d({enumerable:!0,ignoreUndefined:!0},n)).ignoreUndefined&&(t=i(t),e=i(e));var o=n.enumerable?Object.keys(t):Object.getOwnPropertyNames(),a=n.enumerable?Object.keys(e):Object.getOwnPropertyNames();if(o.length!=a.length)return!1;t=this.isScopeProxy(t)?t.__target:t,e=this.isScopeProxy(e)?e.__target:e;for(var s=0,l=o.length;s<l;s++){var u=o[s];if(!this.compare(t[u],e[u]))return!1}return!0}return t===e},escapeForRegExp:function(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},createHash:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!n.ignoreScopeHash&&this.isScopeProxy(t)&&t.__hash)return t.__hash;var i=function n(i){if(!i||"object"!=r(i))return String(i);if(e.isScopeProxy(i)){if(i!==t&&i.__hash)return i.__hash;i=i.__target}for(var o=Object.keys(i),a=o.length,s="",l=0;l<a;l++){var u=o[l];s+='"'.concat(u,'"::"').concat(n(i[u]),'";;')}return s};t=i(t);for(var o=0,a=0;a<t.length;a++){var s=t.charCodeAt(a);o=(o<<5)-o+s,o&=o}return o+""},encodeHtmlEntities:function(t){var e,n=document.createElement("div");return n.textContent=t,e=n.innerHTML,n.remove(),n=null,e},decodeHtmlEntities:function(t){var e,n=document.createElement("textarea");return n.innerHTML=t,e=n.value,n.remove(),n=null,e},toCamelCase:function(t){return t.replace(/\W+(.)/g,(function(t,e){return e.toUpperCase()}))},capitalize:function(t){return t[0].toUpperCase()+t.slice(1)},toDashCase:function(t){return t.replace(/([A-Z])/g,(function(t,e){return"-".concat(e.toLowerCase())}))},getPropertyByKeys:function(t,e){var n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o="ERR_ARRAY_REDUCE_BREAK",a=t.length,s=0,l=Array.isArray(i.closest)?i.closest:[],u=function(){var t=new Error("Break the reducer");throw t.code=o,t},c=function(t,e){return s++,t&&"object"==r(t)||u(),void 0===t[e]&&i.closest&&(n=l.length?t:void 0,u()),l.push(e),void 0===t[e]?{}:(s==a&&(n=t[e]),t[e])};try{t.reduce(c,e)}catch(t){if(t.code!=o)throw t}return n},hasPropertyByKeys:function(t,e){var n=!1,i=t.length,o=0;return t.reduce((function(t,e){return o++,t&&"object"==r(t)?Object.prototype.hasOwnProperty.call(t,e)?(o==i&&(n=Object.prototype.hasOwnProperty.call(t,e)),t[e]):{}:!!t}),e),n},hasEnumerablePropertyByKeys:function(t,e){var n=!1,i=t.length,o=0;return t.reduce((function(t,e){return o++,t&&"object"==r(t)?Object.prototype.propertyIsEnumerable.call(t,e)?(o==i&&(n=Object.prototype.hasOwnProperty.call(t,e)),t[e]):{}:!!t}),e),n},setPropertyByKeys:function(t,e,n){var i=void 0,o=t.length,a=0;return t.reduce((function(t,e){if(a++,t&&"object"==r(t))return Object.prototype.hasOwnProperty.call(t,e)||(t[e]=void 0),t[e]=n(a==o,t[e]),i=t,t[e]}),e),i},deletePropertyByKeys:function(t,e,n){var i,o=t.length,a=0;return t.reduce((function(t,e){if(a++,t&&"object"==r(t))return Object.prototype.hasOwnProperty.call(t,e)?a==o?(i=t[e],(!n||n(i))&&delete t[e],i):t[e]:{}}),e),i},getEnumerablePropertyTarget:function(t,e){var n=this;return function t(r){if(n.hasEnumerablePropertyByKeys(e,r))return r;var i=Object.getPrototypeOf(r);return i?t(i):null}(t)},getOwnPropertyTarget:function(t,e){var n=this;return function t(r){if(n.hasPropertyByKeys(e,r))return r;var i=Object.getPrototypeOf(r);return i?t(i):null}(t)},createRandomString:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=Math.random().toString(36).substring(2,t+2),r=Date.now(),i="",o=0,a=n.length;o<a;o++)i+=r%o?n[o]:n[o].toUpperCase();return e&&e(i)?this.createRandomString(t,e):i},debounce:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=function n(){clearTimeout(t.__debounceTimeout),t.__debounceTimeout=setTimeout((function(){t(),n.removeDebounce()}),e)};return n.removeDebounce=function(){clearTimeout(t.__debounceTimeout),delete t.__debounceTimeout},n}};const m=y;var g=function(){function t(e,n,r){u(this,t),this.__name=e,this.__el=n,this.__component=r,n.setAttribute("scope",e)}return h(t,[{key:"__set",value:function(t,e){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Array.isArray(t)||(t=[t]),Ft.unisolate((function(){r.saveProxy&&(n.__component.__disableProxyRedefining=!0),r.silent&&n.__component.__disableKeys(),m.setPropertyByKeys(t,r.target?n.__target:n,(function(t,n){return t?e:n||{}})),r.silent&&n.__component.__enableKeys(),r.saveProxy&&(n.__component.__disableProxyRedefining=!1)}))}},{key:"__remove",value:function(){for(var t in Ft.removeScope(this.__name),this)Object.prototype.hasOwnProperty.call(this,t)&&delete this[t]}}]),t}();function b(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function k(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?b(Object(r),!0).forEach((function(e){n(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):b(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var w=function(){function t(e,r){u(this,t),n(this,"__cache",{}),n(this,"getHeaders",(function(t){for(var e={},n=t.getAllResponseHeaders().split("\r\n"),r=0,i=n.length;r<i;r++){var o=n[r],a=o.indexOf(": ");if(a>0){var s=o.substring(0,a),l=o.substring(a+2);e[s]=l}}return e})),this.baseUrl=e?e.replace(/\/$/,"")+"/":"",this.defaults=k({statusErrorPattern:/^[^23]/,cache:!1},r||{})}return h(t,[{key:"query",value:function(t){var e=this;return new Promise((function(n,r){(t=k(k({},e.defaults),t||{})).url=e.baseUrl?"".concat(e.baseUrl).concat(t.url.replace(/^\//,"")):t.url,t.method=t.method||"GET";var i=new XMLHttpRequest,o=e.transformBefore(i,t);if(i=o.xhr,"function"==typeof(t=o.options).onStart&&t.onStart(i),t.headers=t.headers||{},t.json?(!0!==t.json&&(t.body=JSON.stringify(t.json)),t.headers["content-type"]="application/json",t.responseType=t.responseType||"json"):t.form&&(t.body=e.createFormData(t.form),t.headers["content-type"]="multipart/form-data"),t.params){var a=e.paramsToQuery(t.params);a&&(t.url+="?"+a)}var s=null,l="function"==typeof t.cache?t.cache(t):t.cache;if(!window.AKILI_SSR&&!Ft.__init&&(l=!0),"GET"!=t.method.toUpperCase()||t.body&&"string"!=typeof t.body||(s=e.createCacheHash({url:t.url,method:t.method,user:t.user,password:t.password,body:t.body})),l&&s){var u=e.getCache(s),c=(new Date).getTime();if(u&&(!0===l||c-u.createdAt<=l))return n(e.transformAfter(u.result))}i.open(t.method,t.url,!0,t.user,t.password),Object.prototype.hasOwnProperty.call(t,"timeout")&&(i.timeout=t.timeout),t.responseType&&(i.responseType=t.responseType),t.withCredentials&&(i.withCredentials=t.withCredentials);for(var h=Object.keys(t.headers),_=0,f=h.length;_<f;_++){var p=h[_];i.setRequestHeader(p,t.headers[p])}"function"==typeof t.onProgress&&(i.onprogress=function(e){return t.onProgress(e,i)}),i.onload=function(){var o={response:i.response,status:i.status,readyState:i.readyState,statusText:i.statusText,withCredentials:i.withCredentials,responseType:i.responseType,responseText:"text"==i.responseType?i.responseText:"",responseXML:"document"==i.responseType?i.responseXML:"",responseURL:i.responseURL,timeout:i.timeout,headers:e.getHeaders(i)},a=e.transformAfter(o);if(t.statusErrorPattern&&(i.status+"").match(t.statusErrorPattern)){var u=new Error('Request to "'.concat(t.url,'" returns failure status code ').concat(i.status));return u.response=a,r(u)}(l||window.AKILI_SSR)&&s&&e.createCache(s,o),n(a)},i.ontimeout=function(){return r(new Error('Request to "'.concat(t.url,'" timed out')))},i.onerror=r,i.send(t.body)}))}},{key:"getCache",value:function(t){return this.__cache[t]||null}},{key:"createCache",value:function(t,e){this.__cache[t]={result:e,createdAt:(new Date).getTime()}}},{key:"removeCache",value:function(t){delete this.__cache[t]}},{key:"createCacheHash",value:function(t){return m.createHash(t)}},{key:"paramsToQuery",value:function(t){return t&&"object"===r(t)?Object.keys(t).map((function(e){var n=encodeURIComponent(e);if(Array.isArray(t[e]))return n=encodeURIComponent(e),t[e].map((function(t,e){return n+"[".concat(e,"]")+"="+encodeURIComponent(t)})).join("&");if(t[e]&&"object"===r(t[e])){var i=[];return Object.keys(t[e]).map((function(r){return i.push(n+"[".concat(r,"]")+"="+encodeURIComponent(t[e][r]))})),i.join("&")}return n+"="+encodeURIComponent(t[e])})).join("&"):""}},{key:"paramsFromQuery",value:function(t){for(var e={},n=t.split("&"),r=0,i=n.length;r<i;r++){var o=n[r].split("="),a=decodeURIComponent(o[0]),s=decodeURIComponent(o[1]);a&&(Array.isArray(e[a])?e[a].push(s):e[a]?e[a]=[e[a],s]:e[a]=s)}return e}},{key:"createFormData",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=e||new FormData;for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&t[i]){var o=n?n+"["+i+"]":i;t[i]instanceof Date?r.append(o,t[i].toISOString()):m.isPlainObject(t[i])?this.createFormData(t[i],r,o):r.append(o,t[i])}return r}},{key:"transformBefore",value:function(t,e){return{xhr:t,options:e}}},{key:"transformAfter",value:function(t){return k(k({},t),{},{data:t.response})}},{key:"get",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.url=t,e.method="GET",this.query(e)}},{key:"delete",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.url=t,e.method="DELETE",this.query(e)}},{key:"post",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.url=t,e.method="POST",this.query(e)}},{key:"put",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.url=t,e.method="PUT",this.query(e)}},{key:"patch",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.url=t,e.method="PATCH",this.query(e)}},{key:"head",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.url=t,e.method="HEAD",this.query(e)}}]),t}(),O=new w;O.__instances={},O.__cache={},O.addInstance=function(t,e){this.__instances[t]=e},O.removeInstance=function(t){delete this.__instances[t]},Object.defineProperty(O,"use",{get:function(){return O.__instances}}),O.Request=w;const P=O;var A=j({},[]);function S(t,e){var n=t.length?[t[0]]:[e],r=n[0],i=[].concat(l(t),[e]),o="store.".concat(r);Ft.__isolation[o]={updatedAt:Date.now(),rootKey:r,rootKeys:n,keys:i}}function j(t,e){if("object"!=r(t)||null===t)return t;if(!m.isPlainObject(t)&&!m.isStoreProxy(t)&&t!==A)return t;var n=t;t.__isProxy&&(n=t.__target,m.isStoreProxy(t)&&Ft.joinBindingKeys(e)==Ft.joinBindingKeys(t.__keys)||(t=n=m.copy(n,{nested:!1})));for(var i=Object.keys(t),o=0,a=i.length;o<a;o++){var s=i[o],u=n[s];n[s]=j(u,[].concat(l(e),[s]))}return t.__isProxy?t:function(t,e){return new Proxy(t,{get:function(n,r){return"__target"==r?t:"__keys"==r?e:"__isProxy"==r||n[r]},set:function(t,n,r){var i=[].concat(l(e),[n]),o=i[0];if(t[n]=j(r,i),Ft.__disableStoreProxy)return!0;if(Ft.__isolation)return S(e,n),!0;var a=m.copy(A[o],{plain:!0});return Ft.root&&Ft.root.__storeTriggerByName(o,a),!0},deleteProperty:function(t,n){if(Ft.__disableStoreProxy)return delete t[n],!0;var r=[].concat(l(e),[n])[0],i=r===n?void 0:A[r];if(Ft.__isolation)return S(e,n),delete t[n],!0;var o=m.copy(i,{plain:!0});return Ft.root&&Ft.root.__storeTriggerByName(r,o),delete t[n],!0}})}(t,e)}const R=A;var E={};const L=new Proxy(E,{get:function(t,e){return"__target"==e?E:t[e]},set:function(t,e,n){return t[e]=Ft.wrap(n,{tag:e}),!0},deleteProperty:function(t,e){return Ft.removeTag(e),delete t[e],!0}});function B(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function x(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?B(Object(r),!0).forEach((function(e){n(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):B(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var C=/\${(((?!\${).)*)}/,T=new RegExp(C.source,"g"),K=["component","scope","no-ssr"],N=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(u(this,t),!(e instanceof Element))throw new Error("You must pass an html element to the component constructor");this.__isCreated=!1,this.__isMounted=!1,this.__isCompiled=!1,this.__isResolved=!1,this.__isRemoved=!1,this.__cancelled=!1,this.__prevent=!1,this.__bindings={},this.__evaluatingEvent=null,this.__recompiling=null,this.__compiling=null,this.__disableProxy={},this.__disableStoreKeys={},this.__disableAttrKeys={},this.__children=[],this.__parent=null,this.__parents=[],this.__content="",this.__attrs={},this.__attrLinks={},this.__storeLinks={},this.__attributeOf=null,this.__evaluationComponent=this,this.scope=n,this.el=e,!this.constructor.ssr&&window.AKILI_SSR&&this.cancel()}return h(t,[{key:"__createCompilationOptions",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return x({checkChanges:!1,setEvents:!0,setParents:!0,setBooleanAttributes:!0,defineAttributes:!0},t)}},{key:"__createRecompilationOptions",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return x(x({},this.__createCompilationOptions()),{},{setEvents:!1,setParents:!1,defineAttributes:!1},t)}},{key:"__recompile",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.__isMounted=!1,this.__recompiling=!0,this.__evaluationComponent.__disableProxy={},this.__compiling=this.__createRecompilationOptions(t),this.__compiling.setEvents&&this.__setEvents(),this.__compiling.setParents&&this.__setParents(),this.__compiling.setBooleanAttributes&&this.__setBooleanAttributes(),this.__compiling.defineAttributes&&this.__defineAttributes()}},{key:"__create",value:function(){var t=this;this.__compiling=this.__createCompilationOptions(),this.__initialize(),this.__setEvents(),this.__setParents(),this.__setBooleanAttributes(),this.__defineAttributes(),Ft.isolate((function(){return t.created(t.attrs)})),this.__isCreated=!0}},{key:"__compile",value:function(){var t=this,e=this.__controlAttributes||!this.__evaluationParent,n=Promise.resolve();this.__attributeOf=e?this:this.__evaluationParent.__akili,(!this.__recompiling||this.__compiling.newParent||this.__controlAttributes)&&this.__interpolateAttributes(this.el,this.__attributeOf);var r;return function e(n,r){for(var i=0,o=n.length;i<o;i++){var a=n[i];3==a.nodeType&&t.__initializeNode(a,r)?t.__evaluateNode(a,!!t.__compiling&&t.__compiling.checkChanges):1!=a.nodeType||a.__akili||(t.__interpolateAttributes(a),e(a.childNodes,a))}}(this.el.childNodes,this.el),this.__isMounted=!0,this.__recompiling?r=Ft.isolate((function(){t.attrs.onRecompiled&&t.attrs.onRecompiled.trigger(void 0,{bubbles:!1}),t.recompiled()})):(r=Ft.isolate((function(){return t.attrs.onCompiled&&t.attrs.onCompiled.trigger(void 0,{bubbles:!1}),t.compiled()})),this.constructor.templateUrl&&(n=P.get(this.constructor.templateUrl,{cache:this.constructor.templateCache}).then((function(e){return t.el.innerHTML=t.__content,Ft.setTemplate(t.el,e.data),delete t.__content,Ft.compile(t.el,{recompile:!0})})))),this.__recompiling=null,this.__compiling=null,n.then((function(){return t.__isCompiled=!0,r}))}},{key:"__resolve",value:function(){var t=this;return this.__isResolved||this.__isRemoved?Promise.resolve():(this.attrs.onResolved&&this.attrs.onResolved.trigger(void 0,{bubbles:!1}),Promise.resolve(Ft.isolate((function(){return t.resolved()}))).then((function(e){return t.__isResolved=!0,e})))}},{key:"__initialize",value:function(){var t,e=Ft.getAkiliParents(this.el,!1),n=this.constructor.scope||Ft.Scope,r=Ft.__root===this.el;this.el.__akili=this,e?t=new n(this.el.getAttribute("scope")||Ft.createScopeName(),this.el,this):(t=new n(r?"root":Ft.createScopeName(),this.el,this),r&&(Ft.root=this));var i=t,o=Object.assign(t,this.scope),a=this.constructor.controlAttributes,s=this.constructor.events;return this.constructor.template&&Ft.setTemplate(this.el,this.constructor.template),this.constructor.templateUrl&&(this.__content=this.el.innerHTML,this.el.innerHTML=""),this.__scope=i,this.__events=s,this.__controlAttributes=a,Ft.addScope(t),this.scope=this.__nestedObserve(o,[]),!0}},{key:"__setBooleanAttributes",value:function(){var t=this;this.booleanAttributes=[].concat(Ft.htmlBooleanAttributes,this.constructor.booleanAttributes);!function e(n){for(var r=0,i=n.attributes,o=i.length;r<o;r++){var a=i[r];if(-1!=t.booleanAttributes.indexOf(a.nodeName)){if(n.hasAttribute("boolean-".concat(a.nodeName)))continue;n.setAttribute("boolean-".concat(a.nodeName),n.getAttribute(a.nodeName)||a.nodeName),n.removeAttribute(a.nodeName)}}for(var s=0,l=n.children.length;s<l;s++){var u=n.children[s];u.__akili||e(u)}}(this.el)}},{key:"__setEvents",value:function(){for(var t=0,e=this.__events.length;t<e;t++){var n=this.__events[t];!/^on-/i.test(n)&&(n="on-"+n),this.el.hasAttribute(n)||this.el.setAttribute(n,"")}}},{key:"__setParents",value:function(){var t=Ft.getAkiliParents(this.el);if(t.length){for(var e=this.__parent!==t[0],n=null,r=0,i=t.length;r<i;r++){var o=t[r];if(!o.__akili.constructor.transparent){n=o;break}}this.__compiling.newParent=e,e&&this.__detach(),this.constructor.transparent&&(this.__evaluationComponent=n.__akili),this.__evaluationParent=n,this.__parent=t[0],this.__parents=t,this.scope.__parent=this.__evaluationParent.__akili.scope,!this.__recompiling&&this.__parent.__akili.__addChild(this.el),Object.setPrototypeOf(this.scope,this.__parent.__akili.__scope)}}},{key:"__addChild",value:function(t){this.__children.push(t)}},{key:"__spliceChild",value:function(t){for(var e=0,n=this.__children.length;e<n;e++){this.__children[e]===t&&(this.__children.splice(e,1),e--,n--)}}},{key:"__getParsedExpression",value:function(t){return t}},{key:"__checkEvaluation",value:function(t){if(!Object.keys(t.__properties).length)return!0;for(var e in t.__properties)if(Object.prototype.hasOwnProperty.call(t.__properties,e)){var n=t.__properties[e],r=m.getPropertyByKeys(n.keys,n.component.__scope);if(!t.__component.__compareNodePropertyValue(n,r))return!0}return!1}},{key:"__checkNodePropertyChange",value:function(t,e,n){var r=this.__getNodeProperty(t,e);return!r||!t.__component.__compareNodePropertyValue(r,n)}},{key:"__compareNodePropertyValue",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return m.compare(m.createHash(e),t.hash,n)}},{key:"__createExceptionMessage",value:function(t,e){var n=t.__component.el.tagName,r=(t.__component.el.getAttribute("component")||n).toLowerCase(),i=t.__element.tagName.toLowerCase(),o=t instanceof window.Attr?t.name.toLowerCase():"",a=[e.message,t.__expression.trim()];return o&&a.push("[attribute ".concat(o,"]")),"Expression error: "+(a=a.concat(["[element ".concat(i,"]"),"[component ".concat(r,"]")])).join("\n\tat ")}},{key:"__evaluate",value:function(t){var e,n,i=this,o=0,a=t.__attributeOf||t.__component;return t.__component.parents((function(t){return t.__prevent})).length?{res:t.__expression}:t instanceof window.Attr||!t.__component.__prevent?{res:t.__expression.replace(T,(function(s,l){var u;o++;var c=t.__component.__getParsedExpression(l);i.__finishEvaluationCycle(),Ft.__evaluation={node:t,list:[],component:a};try{u=i.constructor.parse(a.__evaluationComponent.scope,c,x({},L))}catch(e){throw i.__createExceptionMessage(t,e)}if(i.__finishEvaluationCycle(),t instanceof window.Attr)return n=s,e=u,m.makeAttributeValue(u);if("object"==r(u))try{return JSON.stringify(u)}catch(t){return u}return u})),counter:o,expression:n,attributeValue:e}:{res:t.__expression}}},{key:"__finishEvaluationCycle",value:function(){var t,e,n=[],r={};Ft.__evaluation&&(t=Ft.__evaluation.node,e=Ft.__evaluation.component,n=Ft.__evaluation.list,Ft.__evaluation.list=null,Ft.__evaluation=null);for(var i=n.length-1;i>=0;i--){var o=n[i];if(!o.component.__isRemoved){var a=o.component.__createKeysHash(o.keys);if(!o.notBinding&&!r[a]){var s=m.getPropertyByKeys(o.parents,o.component.__scope);m.isScopeProxy(s)&&o.component!==e.__evaluationComponent&&o.component===o.bindComponent||(o.bindComponent.__bindAndSetProperty(t,o.keys,o.evaluated),r[a]=!0)}}}}},{key:"__bindAndSetProperty",value:function(t,e,n){var r=this.__getBoundNode(e,t),i=m.getPropertyByKeys(e,this.__scope);r||this.__bind(e,{node:t,keys:e}),this.__setNodeProperty(t,e,i,n)}},{key:"__getEvaluationComponents",value:function(t){var e=[];return function n(r){r.__getBind(t)&&e.push(r);for(var i=0;i<r.__children.length;i++)n(r.__children[i].__akili)}(this),e.length?e:[this]}},{key:"__evaluateOwnKeys",value:function(t){for(var e=this.__getAllBinds(t),n=0;n<e.length;n++){var r=e[n];if(r){var i=r.node;if(r.node&&i.__initialized){var o=m.getPropertyByKeys(r.keys,this.__scope);if(this.__checkNodePropertyChange(i,r.keys,o)){for(var a in this.__disableKeys(t),this.__evaluateNode(i),i.__properties){i.__properties[a].component.__setNodeProperty(i,r.keys,o)}this.__enableKeys(t)}}}}}},{key:"__evaluateByKeys",value:function(t){var e=this;t=l(t);!function n(){for(var r=e.__getEvaluationComponents(t),i=0;i<r.length;i++){r[i].__evaluateOwnKeys(t)}t.pop(),t.length&&n()}()}},{key:"__evaluateEvent",value:function(t,e,n){var r,i=C.exec(t.__expression);if(i){this.__evaluatingEvent={el:e,component:this,event:n,node:t},this.__disableProxy={};try{r=this.constructor.parse(this.__evaluationComponent.scope,i[1],x(x({},L),{},{event:n}))}catch(e){throw this.__createExceptionMessage(t,e)}return this.__evaluatingEvent=null,r}}},{key:"__evaluateNode",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=t instanceof window.Attr?"value":"nodeValue";if(!e||this.__checkEvaluation(t)){var r=this.__evaluate(t),i=r.res,o=r.attributeValue,a=r.expression,s=r.counter;if(t[n]!=i&&(t[n]=i),t instanceof window.Attr){var l=i,u=!1;1==s&&a&&t.__expression==a&&(l=o);var c=t.nodeName.replace(/^boolean-(.+)/i,"$1"),h=m.toCamelCase(c);if(c!=t.nodeName&&(u=!0,l=!!l),t.__attributeOn){var _=t.__attributeOn;l=_.__prepareAttributeIn(t,l),_.__disableAttributeSetter=!0,_.attrs[h]=l,_.__disableAttributeSetter=!1,_.__isMounted&&_.__attrTriggerByName(h,l)}else if(u){var f=t.__element;l?f.setAttribute(h,"true"):f.removeAttribute(h)}}}return t[n]}},{key:"__prepareAttributeIn",value:function(t,e){return m.copy(e,{plain:!0})}},{key:"__prepareAttributeOut",value:function(t,e){return m.copy(e,{plain:!0})}},{key:"__initializeAttribute",value:function(t,e,n){if(t&&-1==K.indexOf(t.nodeName)&&this.__initializeNode(t,e)){var r=t.nodeName.replace(/^on-(.+)/i,"$1"),i=n||this;if(t.__isEvent){if(t.__event)return;var o=new Ft.EventEmitter(r,t,e,i);return t.__hasBindings&&o.bind((function(n){return i.__evaluateEvent(t,e,n)})),t.__event=o,e.setAttribute(t.nodeName,m.makeAttributeValue(o)),void(n&&(this.__disableAttributeSetter=!0,this.attrs[m.toCamelCase(t.nodeName)]=o,this.__disableAttributeSetter=!1))}n&&(t.__attributeOn=this,t.__attributeOf=i);var a=!!this.__compiling&&this.__compiling.checkChanges;i.__evaluateNode(t,a)}}},{key:"__initializeNode",value:function(t,e){if(t.__initialized)return!0;var n=t instanceof window.Attr,r=t[n?"value":"nodeValue"],i=C.test(r.trim()),o=!!n&&/^boolean-/i.test(t.nodeName),a=!!n&&/^on-(.+)/i.test(t.nodeName);return!!(e.__akili||i||o||a)&&(t.__name=this.__scope.__name+m.createRandomString(16),t.__isEvent=a,t.__hasBindings=i,t.__isBoolean=o,t.__expression=r,t.__properties={},t.__attributeOf=null,t.__attributeOn=null,t.__event=null,t.__initialized=!0,t.__component=this,t.__element=e,!0)}},{key:"__deinitializeNode",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.__initialized&&(t.__event&&t.__event.remove(),t.__hasBindings&&!e.saveBindings&&(this.__unbindByNodes(t),this.__unbindParentsByNodes(t)),Ft.removeTag(t),delete t.__name,delete t.__hasBindings,delete t.__isBoolean,delete t.__isEvent,delete t.__expression,delete t.__properties,delete t.__attributeOf,delete t.__attributeOn,delete t.__event,delete t.__initialized,delete t.__component,delete t.__element)}},{key:"__interpolateAttributes",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=0,r=t.attributes,i=r.length;n<i;n++)this.__initializeAttribute(r[n],t,e)}},{key:"__defineAttributes",value:function(){var t=this,e=function(e,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!t.__disableAttributeSetter){var i=t.el.getAttributeNode(e);if(r)return i&&t.__deinitializeNode(i),void t.el.removeAttribute(e);i?(i.value=n,t.__deinitializeNode(i)):(t.el.setAttribute(e,n),i=t.el.getAttributeNode(e)),t.__initializeAttribute(i,t.el,t.__attributeOf)}};this.attrs=new Proxy(this.__attrs,{get:function(t,e){return"__isProxy"==e||t[e]},set:function(n,r,i){var o=m.toDashCase(r);return-1!=t.booleanAttributes.indexOf(o)&&(i?t.el.setAttribute(o,i):t.el.removeAttribute(o),o="boolean-".concat(o)),n[r]=i,e(o,m.makeAttributeValue(i)),!0},deleteProperty:function(t,n,r){var i=m.toDashCase(n);return e(i,m.makeAttributeValue(r),!0),delete t[n],!0}})}},{key:"__observe",value:function(t,e){var n=this;return new Proxy(t,{get:function(r,i){if("__isProxy"==i)return!0;if("__target"==i)return t;if("__component"==i)return n;if("__keys"==i)return e;if(n.__isSystemKey(i))return r[i];if(Ft.__evaluation&&!n.__isRemoved){var o=[].concat(e,[i]),a=!1,s=!m.getOwnPropertyTarget(n.__scope,o),l=n;if(r instanceof g){var u=m.getOwnPropertyTarget(r,[i]);u&&u instanceof g&&(l=u.__component)}return Ft.__wrapping&&o.length>1||(i in r&&!m.getEnumerablePropertyTarget(r,[i])&&(a=!0),n.__bindNode(Ft.__evaluation.list,l,o,e,r[i],a,s)),r[i]}return r[i]},set:function(t,r,i){var o=[].concat(l(e),[r]);return n.__isRemoved||n.__isSystemKey(r)||n.__checkDisablement(o)?(t[r]=i,n.__setScopeObjectHash(t,o),!0):n.__isCreated&&void 0!==i&&!Object.prototype.hasOwnProperty.call(t,r)&&r in t?(m.getEnumerablePropertyTarget(t,[r]).__component.scope[r]=i,!1):("function"==typeof i&&(i=Ft.wrapFunction(i)),t[r]=n.__nestedObserve(i,o),n.__isResolved||n.__triggerStoreAndAttr(o),Ft.__isolation?(n.__createIsolationObject(e,r),!0):(n.__setScopeObjectHash(t,o),n.__isResolved&&n.__triggerStoreAndAttr(o),n.__isMounted&&n.__evaluateByKeys(o),!0))},deleteProperty:function(t,r){var i=[].concat(e,[r]);return n.__isRemoved||n.__isSystemKey(r)||n.__checkDisablement(i)?(delete t[r],n.__setScopeObjectHash(t,i),!0):(delete t[r],n.__isResolved||n.__triggerStoreAndAttr(i),Ft.__isolation?(n.__createIsolationObject(e,r),!0):(n.__isResolved&&n.__triggerStoreAndAttr(i),n.__setScopeObjectHash(t,i),n.__evaluateByKeys(i),!0))}})}},{key:"__triggerStoreAndAttr",value:function(t){for(var e=0,n=t.length;e<n;e++){var r=t.slice(0,n-e),i=Ft.joinBindingKeys(r),o=m.getPropertyByKeys(r,this.__scope);this.__storeLinks[i]&&this.__storeTriggerByKeys(r,o),this.__attrLinks[i]&&this.__attrTriggerByKeys(r,o)}}},{key:"__createKeysHash",value:function(t){return"scope.".concat(this.__scope.__name,".").concat(Ft.joinBindingKeys(t))}},{key:"__getDisablementTypeStore",value:function(t){return{proxy:"__disableProxy",store:"__disableStoreKeys",attr:"__disableAttrKeys"}[t]}},{key:"__disableKeys",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"proxy";this[this.__getDisablementTypeStore(e)][t?this.__createKeysHash(t):"__all"]=!0}},{key:"__enableKeys",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"proxy";delete this[this.__getDisablementTypeStore(e)][t?this.__createKeysHash(t):"__all"]}},{key:"__checkDisablement",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"proxy",n=this.__getDisablementTypeStore(e);return!!this[n].__all||this[n][this.__createKeysHash(t)]}},{key:"__storeTriggerByKeys",value:function(t,e){if(!this.__checkDisablement(t,"store")){var n=this.__storeLinks[Ft.joinBindingKeys(t)];if(n&&n.length){e=m.copy(e,{plain:!0});for(var r=[],i=0,o=n.length;i<o;i++){var a=n[i];a.set&&r.push(this.__storeTriggerByName(a.name,e))}return Promise.all(r)}}}},{key:"__storeTriggerByName",value:function(t,e){var n=this;Ft.__disableStoreProxy=!0,R[t]=e,Ft.__disableStoreProxy=!1;var r=(Ft.__storeLinks[t]||[]).concat(Ft.__storeLinks["*"]||[]);if(r&&r.length)for(var i=function(i,o){var a=r[i],s=a.component;if(s===n)return"continue";if(a.fn)return Ft.isolate((function(){return a.fn.call(s,e,t)})),"continue";if(!a.get)return"continue";s.__disableKeys(a.keys,"store");var l=m.getPropertyByKeys(a.keys,s.__scope);!m.compare(l,e)&&s.scope.__set(a.keys,e),s.__enableKeys(a.keys,"store")},o=0,a=(r=m.sort(r,["date"],!0)).length;o<a;o++)i(o)}},{key:"__storeByKeys",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(n=x({get:!0,set:!0},n),!e)throw new Error('Store link "'.concat(t,'" must have the scope property name'));if(!n.get&&!n.set)throw new Error('Store link "'.concat(t,'" must have at least "get" or "set" option as true'));Array.isArray(e)||(e=[e]),this.__disableKeys(e,"store"),(Object.prototype.hasOwnProperty.call(R,t)||!m.hasPropertyByKeys(e,this.__scope))&&this.scope.__set(e,R[t]),this.__enableKeys(e,"store");var r,i=Ft.joinBindingKeys(e);this.__storeLinks[i]||(this.__storeLinks[i]=[]);for(var o=this.__storeLinks[i],a=o.length-1;a>=0;a--){var s=o[a];if(s.component===this&&s.name==t&&s.keyString==i)return void(o[a]=x(x(x({},s),n),{},{date:Date.now()}))}Ft.__storeLinks[t]||(Ft.__storeLinks[t]=[]),r=x(x({},n),{},{component:this,name:t,keys:e,keyString:i,date:Date.now()}),this.__storeLinks[i].push(r),Ft.__storeLinks[t].push(r)}},{key:"__storeByFunction",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=void 0===n.callOnStart?Object.prototype.hasOwnProperty.call(R.__target,t):n.callOnStart;Ft.__storeLinks[t]||(Ft.__storeLinks[t]=[]);for(var i=Ft.__storeLinks[t],o=i.length-1;o>=0;o--){var a=i[o];if(a.component===this&&a.name==t&&a.fn===e)return void(i[o]=x(x(x({},a),n),{},{date:Date.now()}))}if(Ft.__storeLinks[t].push(x(x({},n),{},{component:this,name:t,fn:e,date:Date.now()})),"*"==t&&!1!==n.callOnStart){for(var s=Object.keys(R.__target),l=[],u=0,c=s.length;u<c;u++){var h=s[u],_=m.copy(R.__target[h],{plain:!0});l.push(e.call(this,_,h))}return Promise.all(l)}if(r)return e.call(this,m.copy(R.__target[t],{plain:!0}))}},{key:"__unstoreByKeys",value:function(t,e){if(!e)throw new Error('You have to pass the scope property name for store link "'.concat(t,'"'));Array.isArray(e)||(e=[e]);var n=Ft.joinBindingKeys(e),r=this.__storeLinks[n];if(r.length){for(var i=r.length-1;i>=0;i--){var o=r[i],a=Ft.__storeLinks[o.name];if(o.component===this&&o.name==t&&o.keyString==n&&(r.splice(i,1),a&&a.length)){for(var s=a.length-1;s>=0;s--){var l=a[s];l.component===this&&l.keyString==n&&a.splice(s,1)}a.length||delete Ft.__storeLinks[t]}}r.length||delete this.__storeLinks[n]}}},{key:"__unstoreByFunction",value:function(t,e){if(Ft.__storeLinks[t]){for(var n=Ft.__storeLinks[t],r=n.length-1;r>=0;r--){var i=n[r];if(i.component===this&&i.name==t&&i.fn===e){n.splice(r,1);break}}n.length||delete Ft.__storeLinks[t]}}},{key:"__attrTriggerByKeys",value:function(t,e){var n=this;if(!this.__checkDisablement(t,"attr")){var r=this.__attrLinks[Ft.joinBindingKeys(t)];if(r&&r.length)return Ft.isolate((function(){for(var t=0,i=r.length;t<i;t++){var o=r[t];if(!o.fn&&o.set){var a="on"+m.capitalize(o.name);n.attrs[a]&&n.attrs[a].trigger(e,{bubbles:!0})}}}))}}},{key:"__attrTriggerByName",value:function(t,e){var n=this,r=(this.__attrLinks[t]||[]).concat(this.__attrLinks["*"]||[]);if(r&&r.length)for(var i=function(i,o){var a=r[i];if(a.fn)return Ft.isolate((function(){return a.fn.call(n,e,m.toDashCase(t))})),"continue";if(!a.get)return"continue";n.__disableKeys(a.keys,"attr");var s=m.getPropertyByKeys(a.keys,n.__scope);!m.compare(s,e)&&n.scope.__set(a.keys,e),n.__enableKeys(a.keys,"attr")},o=0,a=(r=m.sort(r,["date"],!0)).length;o<a;o++)i(o)}},{key:"__attrByKeys",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(n=x({get:!0,set:!0},n),t=m.toCamelCase(t),!e)throw new Error('Attribute link "'.concat(t,'" must have the scope property name'));Array.isArray(e)||(e=[e]),this.__disableKeys(e,"attr"),(Object.prototype.hasOwnProperty.call(this.attrs,t)||!m.hasPropertyByKeys(e,this.__scope))&&this.scope.__set(e,this.attrs[t]),this.__enableKeys(e,"attr");var r=Ft.joinBindingKeys(e);this.__attrLinks[r]||(this.__attrLinks[r]=[]);for(var i=this.__attrLinks[r],o=i.length-1;o>=0;o--){var a=i[o];if(a.name==t&&a.keyString==r)return void(i[o]=x(x(x({},a),n),{},{date:Date.now()}))}this.__attrLinks[r].push(x(x({},n),{},{name:t,keys:e,keyString:r,date:Date.now(),component:this}))}},{key:"__attrByFunction",value:function(t,e){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};t=m.toCamelCase(t);var i=void 0===r.callOnStart?Object.prototype.hasOwnProperty.call(this.attrs,t):r.callOnStart;this.__attrLinks[t]||(this.__attrLinks[t]=[]);for(var o=this.__attrLinks[t],a=o.length-1;a>=0;a--){var s=o[a];if(s.name==t&&s.fn===e)return void(o[a]=x(x(x({},s),r),{},{date:Date.now()}))}if(this.__attrLinks[t].push(x(x({},r),{},{name:t,fn:e,date:Date.now(),component:this})),"*"==t&&!1!==r.callOnStart){for(var l=Object.keys(this.__attrs).filter((function(t){return!(n.__attrs[t]instanceof Ft.EventEmitter)})),u=[],c=0,h=l.length;c<h;c++){var _=l[c],f=this.__attrs[_];u.push(e.call(this,f,m.toDashCase(_)))}return Promise.all(u)}if(i)return e.call(this,this.attrs[t])}},{key:"__unattrByKeys",value:function(t,e){if(!e)throw new Error('You have to pass the scope property name for attribute link "'.concat(t,'"'));Array.isArray(e)||(e=[e]);var n=Ft.joinBindingKeys(e),r=this.__attrLinks[n];if(r.length){for(var i=r.length-1;i>=0;i--){var o=r[i];o.name==t&&o.keyString==n&&r.splice(i,1)}r.length||delete this.__attrLinks[n]}}},{key:"__unattrByFunction",value:function(t,e){if(this.__attrLinks[t]){for(var n=this.__attrLinks[t],r=n.length-1;r>=0;r--){var i=n[r];if(i.name==t&&i.fn===e){n.splice(r,1);break}}n.length||delete this.__attrLinks[t]}}},{key:"__isSystemKey",value:function(t){return t.match&&t.match("^_|#")||"constructor"==t}},{key:"__setScopeObjectHash",value:function(t,e){!t||"object"!=r(t)||t instanceof g||(Object.defineProperty(t,"__hash",{configurable:!0,enumerable:!1,value:m.createHash(t,{ignoreScopeHash:!0})}),e&&(e=e.slice(0,-1),this.__setScopeObjectHash(m.getPropertyByKeys(e,this.__scope),e)))}},{key:"__nestedObserve",value:function(t,e){var n=this;return function t(e,i){if("object"!=r(e)||null===e)return e;if(!(m.isPlainObject(e)||m.isScopeProxy(e)||e instanceof g))return e;var o=e;t:if(e.__isProxy){if(o=e.__target,n.__disableProxyRedefining)break t;e.__component===n&&Ft.joinBindingKeys(i)==Ft.joinBindingKeys(e.__keys)||(e=o=m.copy(o,{nested:!1}))}else n.__disableProxyRedefining||e instanceof g||(e=o=m.copy(o,{nested:!1}));for(var a=Object.keys(o),s=0,u=a.length;s<u;s++){var c=a[s],h=o[c];o[c]=t(h,[].concat(l(i),[c]))}return n.__setScopeObjectHash(o),e.__isProxy?e:n.__observe(e,i)}(t,e||[])}},{key:"__createIsolationObject",value:function(t,e){var n=t.length?[t[0]]:[e],r=n[0],i=[].concat(l(t),[e]),o=this.__createKeysHash(n);return Ft.__isolation[o]||(Ft.__isolation[o]={updatedAt:Date.now(),component:this,rootKeys:n,rootKey:r,keys:i}),Ft.__isolation[o]}},{key:"__bindNode",value:function(t,e,n,r,i){var o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],a=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=Ft.joinBindingKeys(r),l=this;if(t.length&&!o){var u=t.length-1,c=t[u];c.bindComponent===this&&c.keysString==s&&(l=c.component),c.keysString==s&&c.component===l&&t.splice(u,1)}t.push({component:l,bindComponent:e,keysString:Ft.joinBindingKeys(n),parents:r,keys:n,value:i,evaluated:a,notBinding:o})}},{key:"__isSystemBindingKey",value:function(t){return"__data"==t}},{key:"__getBind",value:function(t){return m.getPropertyByKeys(t,this.__bindings)||null}},{key:"__getAllBinds",value:function(t){var e=this.__getBind(t);if(!e)return[];var n=[];return function t(e){for(var r in n=n.concat(e.__data||[]),e)Object.prototype.hasOwnProperty.call(e,r)&&"__data"!=r&&t(e[r])}(e),n}},{key:"__getBoundNode",value:function(t,e){var n=m.getPropertyByKeys(t,this.__bindings);if(!n||!n.__data||!n.__data.length)return null;for(var r=0,i=n.__data.length;r<i;r++){var o=n.__data[r];if(o.node===e)return o}return null}},{key:"__setNodeProperty",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=this.__getNodeProperty(t,e),o=m.createHash(n);if(i){var a=t.__component.__compareNodePropertyValue(i,n);return i.value=n,i.hash=o,!a}return t.__properties[this.__createKeysHash(e)]={component:this,value:n,hash:o,node:t,keys:e,evaluated:r},!0}},{key:"__getNodeProperty",value:function(t,e){return t.__properties[this.__createKeysHash(e)]||null}},{key:"__deleteNodeProperty",value:function(t,e){var n="scope.".concat(this.__scope.__name,".").concat(Ft.joinBindingKeys(e));delete t.__properties[n]}},{key:"__mapNodes",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};n=x({rootAttrs:!0,attrs:!0,node:!0,el:!0},n);var r=function r(i){if(i){if(n.attrs&&(i!==e.el||n.rootAttrs))for(var o=0,a=i.attributes,s=a.length;o<s;o++)t(a[o]);for(var l=i.childNodes.length-1;l>=0;l--){var u=i.childNodes[l];3==u.nodeType?n.node&&t(u):1!=u.nodeType||u.__akili||(r(u),n.el&&t(u))}}};r(this.el)}},{key:"__getAllNodes",value:function(){var t=[];return this.__mapNodes((function(e){return t.push(e)})),t}},{key:"__bind",value:function(t,e){m.setPropertyByKeys(t,this.__bindings,(function(t,n){var i={__data:[]};return t?("object"==r(n)&&(i=n),i.__data||(i.__data=[]),i.__data.push(e),i):n||i}))}},{key:"__unbindByNodes",value:function(t){var e=this;t instanceof Node&&(t=[t]);!function n(r,i,o){for(var a=Object.keys(r),s=0,l=a.length;s<l;s++){var u=a[s];if("__data"==u){for(var c=r[u]||[],h=c.length,_=0;_<h;_++){var f=c[_];-1!=t.indexOf(f.node)&&(delete f.node,c.splice(_,1),_--,h--)}h||delete r[u]}else e.__isSystemBindingKey(u)||n(r[u],r,u);i&&!Object.keys(r).length&&delete i[o]}}(this.__bindings)}},{key:"__unbindParentsByNodes",value:function(t){for(var e=0,n=this.__parents.length;e<n;e++){var r=this.__parents[e];r&&r.__akili&&r.__akili.__unbindByNodes(t)}}},{key:"__clearStoreLinks",value:function(){var t=Ft.__storeLinks;for(var e in t){for(var n=t[e],r=n.length-1;r>=0;r--){n[r].component===this&&n.splice(r,1)}n.length||delete t[e]}}},{key:"__remove",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.attrs.onRemoved&&this.attrs.onRemoved.trigger(void 0,{bubbles:!1}),this.removed();var e=this.__detach({saveBindings:!0,deinitializeNodes:!0}),n=[].concat(e,this.__empty({saveBindings:!0}));return this.__unbindByNodes(e),!t.saveBindings&&this.__unbindParentsByNodes(n),this.__clearStoreLinks(),this.__scope.__remove(),delete this.__scope,delete this.scope,this.el.remove(),delete this.el.__akili,delete this.el,delete this.__parent,delete this.__attributeOf,delete this.__evaluationComponent,delete this.__evaluationParent,delete this.__parents,delete this.__bindings,delete this.__attrLinks,delete this.__storeLinks,delete this.__attrs,delete this.attrs,this.__isRemoved=!0,n}},{key:"__removeChildren",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=[],n=0;n<this.__children.length;n++){var r=this.__children[n];e=e.concat(r.__akili.__remove(t)),n--}return e}},{key:"__detach",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.__parent&&this.__parent.__akili.__spliceChild(this.el);for(var e=[],n=0,r=this.el.attributes.length;n<r;n++){var i=this.el.attributes[n];i.__initialized&&(e.push(i),t.deinitializeNodes&&this.__deinitializeNode(i,{saveBindings:!0}))}return!t.saveBindings&&this.__unbindParentsByNodes(e),e}},{key:"__empty",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=this.__removeChildren({saveBindings:!0});return this.__mapNodes((function(e){1!=e.nodeType?e.__initialized&&(t.__deinitializeNode(e,{saveBindings:!0}),n.push(e)):e.remove()}),{rootAttrs:!1}),this.__unbindByNodes(n),!e.saveBindings&&this.__unbindParentsByNodes(n),this.el.innerHTML="",n}},{key:"__getParent",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=[],o=0;"object"!=r(n)&&(n=[n]);var a=function r(a){if(a){if((!n||-1!=n.indexOf(o))&&(!t||a.__akili.matches(t))){if(!e)return void i.push(a.__akili);i.push(a.__akili)}o++,r(a.__akili.__parent)}};return a(this.__parent),e?i:i[0]||null}},{key:"__getChildren",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=[],o=0;"object"!=r(n)&&(n=[n]);var a=function r(a){for(var s=0,l=a.length;s<l;s++){var u=a[s];if((!n||-1!=n.indexOf(o))&&(!t||u.__akili.matches(t))){if(!e)return void i.push(u.__akili);i.push(u.__akili)}}o++;for(var c=0,h=a.length;c<h;c++)r(a[c].__akili.__children)};return a(this.__children),e?i:i[0]||null}},{key:"__getNear",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.__parent)return null;var r=this.__parent.__akili.__children.slice(),i=[];n&&r.reverse();for(var o=0,a=r.length;o<a;o++){var s=r[o];if(s===this.el)break;t&&!s.__akili.matches(t)||i.push(s.__akili)}return i.reverse(),e?i:i.length?i[0]:null}},{key:"store",value:function(t,e){if(!this.__isMounted)throw new Error('Method "store" must be called after the compilation. For example, in "compiled" method.');var n=[].slice.call(arguments);return"function"==typeof t&&(n.unshift("*"),e=t),"function"==typeof e?this.__storeByFunction.apply(this,l(n)):this.__storeByKeys.apply(this,l(n))}},{key:"attr",value:function(t,e){if(!this.__isMounted)throw new Error('Method "attr" must be called after the compilation. For example, in "compiled" method.');var n=[].slice.call(arguments);return"function"==typeof t&&(n.unshift("*"),e=t),"function"==typeof e?this.__attrByFunction.apply(this,l(n)):this.__attrByKeys.apply(this,l(n))}},{key:"unstore",value:function(t,e){if(!this.__isMounted)throw new Error('Method "unstore" must be called after the compilation. For example, in "compiled" method.');var n=[].slice.call(arguments);return"function"==typeof t&&(n.unshift("*"),e=t),"function"==typeof e?this.__unstoreByFunction.apply(this,arguments):this.__unstoreByKeys.apply(this,arguments)}},{key:"unattr",value:function(t,e){if(!this.__isMounted)throw new Error('Method "unattr" must be called after the compilation. For example, in "compiled" method.');var n=[].slice.call(arguments);return"function"==typeof t&&(n.unshift("*"),e=t),"function"==typeof e?this.__unattrByFunction.apply(this,arguments):this.__unattrByKeys.apply(this,arguments)}},{key:"matches",value:function(t){return"function"==typeof t?t(this):this.el.matches(t)}},{key:"parent",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.__getParent(t,!1,e)}},{key:"parents",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.__getParent(t,!0,e)}},{key:"child",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.__getChildren(t,!1,e)}},{key:"children",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.__getChildren(t,!0,e)}},{key:"before",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return this.__getNear(t,!0,!1)}},{key:"after",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return this.__getNear(t,!0,!0)}},{key:"prev",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return this.__getNear(t,!1,!1)}},{key:"next",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return this.__getNear(t,!1,!0)}},{key:"appendTo",value:function(t){return t.appendChild(this.el),Ft.compile(this.el,{recompile:{setParents:!0,checkChanges:!1}})}},{key:"cancel",value:function(){this.__cancelled=!0}},{key:"prevent",value:function(){this.__prevent=!0}},{key:"empty",value:function(){return this.__empty.apply(this,arguments)}},{key:"remove",value:function(){return this.__remove.apply(this,arguments)}},{key:"created",value:function(){}},{key:"compiled",value:function(){}},{key:"recompiled",value:function(){}},{key:"resolved",value:function(){}},{key:"removed",value:function(){}},{key:"transition",get:function(){return this.__scope&&this.__scope.__transition||null}},{key:"isCreated",get:function(){return this.__isCreated}},{key:"isCompiled",get:function(){return this.__isCompiled}},{key:"isResolved",get:function(){return this.__isResolved}},{key:"isRemoved",get:function(){return this.__isRemoved}}],[{key:"define",value:function(){Ft.component("component",t)}},{key:"parse",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=[],i=[],o=m.split(e,";",['"',"'","`"]);for(var s in o[o.length-1]="return ".concat(o[o.length-1]),n)r.push(s),i.push(n[s]);return a(Function,r.concat(["".concat(o.join("; "))])).apply(t,i)}}]),t}();function H(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&i(t,e)}function I(t,e){if(e&&("object"===r(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function D(t){return(D=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function U(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=D(t);if(e){var i=D(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return I(this,n)}}n(N,"matches",""),n(N,"booleanAttributes",[]),n(N,"events",[]),n(N,"controlAttributes",!1),n(N,"transparent",!1),n(N,"template",""),n(N,"templateUrl",""),n(N,"scope",null),n(N,"ssr",!0);var M=function(t){H(n,t);var e=U(n);function n(){var t;u(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))).html=t.el.innerHTML,t.el.innerHTML="",t.state=!1,t.active=!1,t.recreate=!1,t.rendered=!1,t.display=getComputedStyle(t.el).display,t}return h(n,[{key:"compiled",value:function(){return this.attr("recreate",this.setRecreation),this.attr("is",this.setIs)}},{key:"setIs",value:function(t){return this.state=!!t,this.setState()}},{key:"setActivity",value:function(t){this.active=t}},{key:"setRecreation",value:function(t){this.recreate=t}},{key:"setState",value:function(){var t,e=this.rendering(),n=this.el.nextElementSibling;if(n&&n.matches("else-if,else"))return n.__akili.setActivity(this.active||this.state),n.__akili.setRecreation(this.recreate),t=n.__akili.setState(),Promise.resolve(e).then((function(){return t}))}},{key:"rendering",value:function(){var t=Promise.resolve();return this.state&&!this.active?(this.el.style.setProperty("display",this.display,"important"),!this.recreate&&this.rendered||(t=this.render())):(this.recreate?this.empty():this.rendered||(t=this.render()),this.el.style.setProperty("display","none","important")),t}},{key:"render",value:function(){var t;return this.empty(),this.el.innerHTML=this.html,t=Ft.compile(this.el,{recompile:!0}),this.rendered=!0,t}}],[{key:"define",value:function(){Ft.component("if",this),Ft.component("else-if",this.ElseIf),Ft.component("else",this.Else)}}]),n}(N);n(M,"transparent",!0),n(M,"matches","[is]"),n(M,"booleanAttributes",["recreate"]);var V=function(t){H(n,t);var e=U(n);function n(){var t;u(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))).active=!0,t}return n}(M),q=function(t){H(n,t);var e=U(n);function n(){var t;u(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))).el.setAttribute("is","true"),t}return n}(V);function F(t,e,n){return(F="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=D(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function z(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=D(t);if(e){var i=D(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return I(this,n)}}n(q,"matches",""),M.ElseIf=V,M.Else=q;var $=function(t){H(n,t);var e=z(n);function n(){var t;u(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))).iterators=[],t.iteratorEl=null,t.reset(),t}return h(n,[{key:"__prepareAttributeIn",value:function(t,e){return t instanceof window.Attr&&"in"==t.name?e:F(D(n.prototype),"__prepareAttributeIn",this).apply(this,arguments)}},{key:"__compareNodePropertyValue",value:function(t,e){var r=t.node;return!(r instanceof window.Attr&&"in"==r.name&&t.value!==e)&&F(D(n.prototype),"__compareNodePropertyValue",this).apply(this,arguments)}},{key:"__stepIterationChunk",value:function(t){var e=this;return new Promise((function(n,r){setTimeout((function(){e.drawChunk(t).then(n).catch(r)}))}))}},{key:"__removeExcessIterators",value:function(){for(var t=Object.keys(this.data).length,e=this.iterators.length;t<e;t++){this.iterators[t].__remove(),this.iterators.splice(t,1),e--,t--}}},{key:"__completeDrawing",value:function(){this.__isRemoved||(this.reset(),this.attrs.onOut.trigger(this.data,{bubbles:!0}))}},{key:"__createIterator",value:function(){for(var t,e=0,r=this.el.children.length;e<r;e++){var i=this.el.children[e];if("loop"==i.getAttribute("component")){t=i;break}t=i}t||((t=document.createElement("loop")).innerHTML=this.el.innerHTML,this.el.innerHTML="",this.el.appendChild(t));var o=t.getAttribute("component");if("loop"!=o){var a=Ft.component(o||t.tagName);if(a){if(!(a.prototype instanceof n)){var s=document.createElement("loop");s.appendChild(t),t=s}}else t.setAttribute("component","loop")}this.html=t.innerHTML,this.iteratorEl=this.__createIteratorElement(t.outerHTML),t.remove()}},{key:"__createIteratorElement",value:function(t){var e=document.createElement("template");return e.innerHTML=t,e.content.firstChild}},{key:"created",value:function(){this.__createIterator()}},{key:"compiled",value:function(){return this.attr("in",this.draw)}},{key:"removed",value:function(){F(D(n.prototype),"removed",this).apply(this,arguments),this.iteratorEl&&this.iteratorEl.remove(),delete this.html,delete this.iterators,delete this.iteratorEl,delete this.__iterator,delete this.__value}},{key:"loop",value:function(t,e,n){var r=Promise.resolve();if(this.__index=n,this.__key=t,this.__value=e,this.__hash=m.createHash(e),this.iterators.length>n){var i=this.iterators[n];return i.setIndex(this.__index===i.index),i.setKey(this.__key===i.key),i.setValue(m.compare(this.__hash,i.hash)),{promise:r,iterator:i}}var o=this.iteratorEl.cloneNode();return o.innerHTML=this.html,this.el.appendChild(o),r=Ft.compile(o),this.iterators.push(o.__akili),{promise:r,iterator:o.__akili}}},{key:"drawChunk",value:function(t){var e=this,n=Object.keys(this.data),i=n.length;if(t==i)return this.__removeExcessIterators(),Promise.resolve(this.__completeDrawing());var o=[],a=t+ +(this.attrs.chunks||i);a>i&&(a=i);for(var s=this.__stepIterationChunk.bind(this),l=function(t){var r=n[t],l=t+1,u=e.loop(r,e.data[r],t);return u.iterator.iterate(t),o.push(u.promise),l!=a?"continue":(l==i&&(e.__removeExcessIterators(),s=e.__completeDrawing.bind(e)),{v:Promise.all(o).then((function(){return s(l)}))})},u=t;u<a;u++){var c=l(u);if("continue"!==c&&"object"===r(c))return c.v}}},{key:"draw",value:function(t){"object"==r(t)&&null!==t||(Ft.options.debug&&console.warn('"For" component "in" attribute value type must be an object/array'),t=[]),this.data=t;var e=[].slice.call(this.el.children);return this.iterators.sort((function(t,n){return e.indexOf(t.el)-e.indexOf(n.el)})),this.__children.sort((function(t,n){return e.indexOf(t)-e.indexOf(n)})),this.drawChunk(0)}},{key:"reset",value:function(){this.__iterator=null,this.__index=0,this.__key="",this.__value=null,this.__hash=""}}],[{key:"define",value:function(){Ft.component("for",this),Ft.component("ol",this),Ft.component("ul",this),Ft.component("thead",this),Ft.component("tbody",this),Ft.component("tfoot",this),Ft.component("tr",this.Loop),Ft.component("loop",this.Loop)}}]),n}(N);n($,"matches","[in]"),n($,"events",["out"]);var Q=function(t){H(n,t);var e=z(n);function n(){var t;u(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))).for=null,t.html=t.el.innerHTML,t.isFor=t.el.hasAttribute("in"),t.isFor||t.el.parentNode.__akili instanceof $||t.cancel(),t}return h(n,[{key:"created",value:function(){if(this.__parent.__akili.__iterator=this,this.for=this.__parent.__akili,this.setIndex(!0),this.setKey(!0),this.setValue(!0),this.isFor)return F(D(n.prototype),"created",this).apply(this,arguments)}},{key:"compiled",value:function(){if(this.isFor)return F(D(n.prototype),"compiled",this).apply(this,arguments)}},{key:"removed",value:function(){F(D(n.prototype),"removed",this).apply(this,arguments),delete this.for,delete this.value}},{key:"setIndex",value:function(t){this.index=this.for.__index,this.scope.__set("loopIndex",this.index,{target:t})}},{key:"setKey",value:function(t){this.key=this.for.__key,this.scope.__set("loopKey",this.key,{target:t})}},{key:"setValue",value:function(t){this.value=this.for.__value,this.scope.__set("loopValue",this.value,{target:t,saveProxy:!0}),this.hash=this.for.__hash}},{key:"iterate",value:function(){}}]),n}($);function W(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=D(t);if(e){var i=D(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return I(this,n)}}n(Q,"matches",""),n(Q,"controlAttributes",!0),$.Loop=Q;var G=function(t){H(n,t);var e=W(n);function n(){var t;u(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))).iteratorTagName="option",t.iterable=t.el.hasAttribute("in"),t}return h(n,[{key:"created",value:function(){var t=this;if(this.el.addEventListener("change",(function(){return t.el.content=t.getContent()})),this.iterable)return F(D(n.prototype),"created",this).apply(this,arguments)}},{key:"compiled",value:function(){return this.iterable&&F(D(n.prototype),"compiled",this).apply(this,arguments),this.attr("multiple",this.setMultiple,{callOnStart:!1}),this.attr("value",this.setValue),this.unattr("in",this.draw),this.attr("in",this.setIn)}},{key:"setIn",value:function(t){return this.draw(t).then(this.redrawSelect.bind(this))}},{key:"redrawSelect",value:function(){for(var t=this.removeUnproperValues(this.el.content),e=t.length?t:null,n=[],r=this.el.options.length-1;r>=0;r--){var i=this.el.options[r],o=!!i.getAttribute("selected");!e||e.includes(i.value)?e?(i.selected=!0,n.push(i.value)):(i.selected=o,o&&n.push(i.value)):i.selected=!1}this.changeValue(this.formatValue(n))}},{key:"setMultiple",value:function(){this.changeValue(this.formatValue(m.copy(this.el.content)))}},{key:"setValue",value:function(t){if(void 0!==t||this.__isCompiled){var e=this.formatValue(t);this.changeValue(e,!m.compare(e,t))}}},{key:"createIteratorElement",value:function(){var t=F(D(n.prototype),"createIteratorElement",this).apply(this,arguments);return t.hasAttribute("value")||t.setAttribute("value",this.html.trim()),t}},{key:"getContent",value:function(){if(!this.attrs.multiple)return this.el.value;for(var t=[],e=0,n=this.el.options.length;e<n;e++){var r=this.el.options[e];r.selected&&t.push(r.value)}return t}},{key:"formatValue",value:function(t){return this.attrs.multiple?(!Array.isArray(t)&&(t=[t]),t=this.removeUnproperValues(t)):(Array.isArray(t)&&(t=t[0]),this.removeUnproperValues(t).length?t:this.getDefaultValue())}},{key:"removeUnproperValues",value:function(t){Array.isArray(t)?t.slice():t=[t];for(var e={},n=0,r=this.el.options.length;n<r;n++)e[this.el.options[n].value]=!0;for(var i=t.length-1;i>=0;i--)e[t[i]]||t.splice(i,1);return t}},{key:"redefine",value:function(){this.el.querySelector("[selected]")||(this.el.value=this.getDefaultValue()),this.changeValue(this.getContent())}},{key:"getDefaultValue",value:function(){var t=this.el.options[0];return this.attrs.multiple?[]:t?t.value:void 0}},{key:"changeValue",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(m.compare(this.el.content,t)){if(!e)return}else{if(Array.isArray(t)){this.el.value=t[t.length-1];for(var n=0,r=this.el.options.length;n<r;n++){var i=this.el.options[n];i.selected=-1!=t.indexOf(i.value)}}else{this.el.value=t;for(var o=0,a=this.el.options.length;o<a;o++){var s=this.el.options[o];s.selected=s.value==t}}this.el.content=t}this.attrs.onChange.dispatch(Event,{bubbles:!0})}}],[{key:"define",value:function(){Ft.component("select",this),Ft.component("option",this.Option)}}]),n}($);n(G,"matches",""),n(G,"booleanAttributes",["multiple"].concat($.booleanAttributes)),n(G,"events",["change"].concat($.events));var Y=function(t){H(n,t);var e=W(n);function n(){var t;u(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))).iterable=t.el.parentNode.__akili.iterable,t.iterable||(t.__cancelled=!1),t}return h(n,[{key:"__getParsedExpression",value:function(t){return m.decodeHtmlEntities(t)}},{key:"compiled",value:function(){this.attr("selected",this.setSelected,{callOnStart:!1}),this.iterable&&F(D(n.prototype),"compiled",this).apply(this,arguments)}},{key:"setSelected",value:function(t){this.el.selected=t,this.for.redefine()}}]),n}(Q);function X(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=D(t);if(e){var i=D(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return I(this,n)}}n(Y,"booleanAttributes",["selected"]),G.Option=Y;var J=function(t){H(n,t);var e=X(n);function n(){var t;u(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))).valueKey="value",t.debounceInterval=500,t}return h(n,[{key:"created",value:function(){var t=this;this.el.hasAttribute("on-debounce")&&this.el.addEventListener("input",m.debounce((function(){t.attrs.onDebounce.trigger(void 0,{bubbles:!0})}),this.debounceInterval))}},{key:"compiled",value:function(){this.attr("focus",this.setFocus),this.attr("value",this.setValue),this.attr("debounce",this.setDebounce)}},{key:"setDebounce",value:function(t){this.debounceInterval=+t}},{key:"setFocus",value:function(t){t?this.setElementFocus():this.setElementBlur()}},{key:"setValue",value:function(t){this.el[this.valueKey]!==t&&(this.el[this.valueKey]=0===t?"0":t||"")}},{key:"setElementFocus",value:function(){return this.setElementFocusOn(this.getElementTextLength())}},{key:"setElementFocusOn",value:function(t){document.activeElement!==this.el&&this.el.focus(),this.el.selectionStart=this.el.selectionEnd=t}},{key:"setElementBlur",value:function(){this.el.blur()}},{key:"getElementTextLength",value:function(){return this.el.value.length}}]),n}(N);function Z(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=D(t);if(e){var i=D(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return I(this,n)}}var tt=function(t){H(n,t);var e=Z(n);function n(){var t;u(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))).isCheckbox="checkbox"==t.el.type,t.isRadio="radio"==t.el.type,t}return h(n,[{key:"compiled",value:function(){return(this.isCheckbox||this.isRadio)&&this.attr("checked",this.setChecked),F(D(n.prototype),"compiled",this).apply(this,arguments)}},{key:"setChecked",value:function(t){t=!!t,this.el.checked!==t&&(this.el.checked=t,this.__isCompiled&&this.attrs.onChange.dispatch(Event,{bubbles:!0}),this.isRadio&&this.changeRadio())}},{key:"setValue",value:function(t){F(D(n.prototype),"setValue",this).apply(this,arguments),this.isRadio&&this.el[this.valueKey]!=t&&this.attrs.onChange.dispatch(Event,{bubbles:!0})}},{key:"changeRadio",value:function(){for(var t=this.el.getAttribute("name"),e="input[type=radio][name='".concat(t,"']:not([scope='").concat(this.scope.__name,"'])"),n=this.parent().children(e),r=0,i=n.length;r<i;r++){var o=n[r];o.setChecked(o.el.checked)}}}],[{key:"define",value:function(){Ft.component("input",this)}}]),n}(J);function et(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=D(t);if(e){var i=D(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return I(this,n)}}n(tt,"booleanAttributes",["checked","multiple"].concat(J.booleanAttributes)),n(tt,"events",["change"].concat(J.events));var nt=function(t){H(n,t);var e=et(n);function n(){var t;u(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))).iterable=t.el.hasAttribute("in"),t}return h(n,[{key:"created",value:function(){var t=this;if(this.el.addEventListener("change",(function(){if(!t._disableInternalEvents){var e=t.getRadioValue();e!==t.prevValue&&(t.prevValue=e,(void 0===t.attrs.value||t.__isResolved)&&t.attrs.onRadio.trigger(e,{bubbles:!0}))}})),this.iterable)return F(D(n.prototype),"created",this).apply(this,arguments)}},{key:"compiled",value:function(){if(this.iterable){var t=F(D(n.prototype),"compiled",this).apply(this,arguments);return this.unattr("in",this.draw),t}}},{key:"resolved",value:function(){return this.attr("value",this.setValue),this.attr("name",this.setNames),this.attr("defaultRequired",this.setDefaultRequired,{callOnStart:!1}),this.attr("in",this.setIn,{callOnStart:!1})}},{key:"setIn",value:function(t){return this.draw(t).then(this.redrawRadio.bind(this))}},{key:"setDefaultRequired",value:function(){return this.setValue(this.prevValue)}},{key:"redrawRadio",value:function(){this.setNames();for(var t=this.isProperValue(this.prevValue)?this.prevValue:null,e=this.children("input[type=radio]"),n=t,r=0,i=e.length;r<i;r++){var o=e[r].el,a=!!o.getAttribute("checked");t&&o.value!==t?o.checked=!1:t?(o.checked=!0,n=o.value):(o.checked=a,a&&(n=o.value))}this.setValue(n)}},{key:"isProperValue",value:function(t){for(var e=this.children("input[type=radio]"),n=0,r=e.length;n<r;n++)if(e[n].el.value===t)return!0;return!1}},{key:"setNames",value:function(t){for(var e=this.children("input[type=radio]"),n=0,r=e.length;n<r;n++)e[n].el.setAttribute("name",t||this.attrs.name)}},{key:"setValue",value:function(t){if(this.attrs.defaultRequired||t!==this.prevValue){var e=this.children("input[type=radio]");if(this.attrs.defaultRequired&&null===t&&e.length&&(t=e[0].el.value),t!==this.prevValue){this._disableInternalEvents=!0;for(var n=0,r=e.length;n<r;n++){var i=e[n];i.setChecked(i.el.value===t)}this._disableInternalEvents=!1,this.prevValue=t,this.attrs.onRadio.trigger(t,{bubbles:!0})}}}},{key:"getRadioValue",value:function(){for(var t=this.children("input[type=radio]"),e=0,n=t.length;e<n;e++){var r=t[e];if(r.el.checked)return r.el.value}return null}}],[{key:"define",value:function(){Ft.component("radio",this),Ft.component("radio-button",this.RadioButton)}}]),n}($);n(nt,"matches","[name]"),n(nt,"events",["radio"].concat($.events)),n(nt,"booleanAttributes",["default-required"].concat($.booleanAttributes));var rt=function(t){H(n,t);var e=et(n);function n(){u(this,n);for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return e.call.apply(e,[this].concat(r))}return h(n,[{key:"compiled",value:function(){return this.attr("value","value"),F(D(n.prototype),"compiled",this).apply(this,arguments)}}]),n}(Q);function it(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=D(t);if(e){var i=D(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return I(this,n)}}n(rt,"template",'<label><input type="radio" value="${this.value}"/>${this.__content}</label>'),nt.RadioButton=rt;var ot=function(t){H(n,t);var e=it(n);function n(){return u(this,n),e.apply(this,arguments)}return h(n,null,[{key:"define",value:function(){Ft.component("textarea",this)}}]),n}(J);function at(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=D(t);if(e){var i=D(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return I(this,n)}}var st=function(t){H(n,t);var e=at(n);function n(){var t;u(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))).el.hasAttribute("editable")&&(t.el.setAttribute("contenteditable",t.el.getAttribute("editable")),t.el.removeAttribute("editable")),"inline"==getComputedStyle(t.el).display&&(t.el.style.display="block"),t.valueKey="innerHTML",t}return h(n,[{key:"walkTextNodes",value:function(t,e){for(var n=t.childNodes,r=0,i=n.length;r<i;r++){var o=n[r];3==o.nodeType?e(o):this.walkTextNodes(o,e)}}},{key:"getElementTextLength",value:function(){var t=0;return this.walkTextNodes(this.el,(function(e){return t+=e.nodeValue.length})),t}},{key:"setElementFocusOn",value:function(t){var e,n=[],r=this.getElementTextLength();if(t>r&&(t=r),t<=0)return this.el.focus();this.walkTextNodes(this.el,(function(t){return n.push(t)}));for(var i=0;i<n.length;i++){if(e=n[i],!(t>n[i].nodeValue.length&&n[i+1])){e=n[i];break}t-=n[i].nodeValue.length}var o=document.createRange(),a=window.getSelection();o.setStart(e,t),o.setEnd(e,t),a.removeAllRanges(),a.addRange(o),this.el.focus()}}],[{key:"define",value:function(){Ft.component("content",this),Ft.alias("[contenteditable]","content")}}]),n}(J);function lt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=D(t);if(e){var i=D(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return I(this,n)}}var ut=function(t){H(n,t);var e=lt(n);function n(){var t;u(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))).html=t.el.innerHTML,t.el.innerHTML="",t.connection=null,t}return h(n,[{key:"compiled",value:function(){return this.attr("cache",this.setCache),this.attr("url",this.setTemplate)}},{key:"setCache",value:function(t){this.cache=t}},{key:"setTemplate",value:function(t){var e=this;return this.connection&&this.connection.abort(),P.get(t,{cache:this.cache,onStart:function(t){e.connection=t}}).then((function(t){return e.connection=null,e.empty(),e.el.innerHTML=e.html,Ft.setTemplate(e.el,t.data),Ft.compile(e.el,{recompile:!0}).then((function(){e.attrs.onLoad.trigger(void 0,{bubbles:!1})}))})).catch((function(t){throw e.attrs.onError.trigger(t,{bubbles:!1}),t}))}}],[{key:"define",value:function(){Ft.component("include",this)}}]),n}(N);function ct(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=D(t);if(e){var i=D(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return I(this,n)}}n(ut,"transparent",!0),n(ut,"matches","[url]"),n(ut,"events",["load","error"]);var ht=function(t){H(n,t);var e=ct(n);function n(){var t;u(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))).urlAttribute="src",t.handlerAttribute=t.el.hasAttribute("urlset")?"urlset":"url",t.elOpacity=getComputedStyle(t.el).opacity,t}return h(n,[{key:"created",value:function(){this.viewport=!1,this.cancelable=!1,this.observer=null,this.finished=!1,this.cancelling=!1,this.onLoadListener=this.onLoad.bind(this),this.onErrorListener=this.onError.bind(this),this.el.addEventListener("load",this.onLoadListener),this.el.addEventListener("error",this.onErrorListener),this.createUrlAttribute()}},{key:"compiled",value:function(){this.attr("loading",this.setLoading),this.attr(this.handlerAttribute,this.setUrl)}},{key:"removed",value:function(){this.observer&&this.observer.disconnect()}},{key:"createUrlAttribute",value:function(){"urlset"==this.handlerAttribute&&this.urlAttribute}},{key:"onLoad",value:function(){this.isRemoved||(this.attrs.hiddenError&&(this.el.style.opacity=this.elOpacity),this.finished=!0,this.cancelling=!1)}},{key:"onError",value:function(){this.isRemoved||(this.attrs.hiddenError&&(this.el.style.opacity=0),!this.cancelling&&(this.finished=!0))}},{key:"intersectionHandler",value:function(t){var e=t[0];if(this.isIntersecting=e.isIntersecting,!e.isIntersecting&&!this.finished)return this.cancelling=!0,void(this.attrs[this.urlAttribute]="");this.finished||(this.cancelling=!1,this.attrs[this.urlAttribute]=this.attrs[this.handlerAttribute])}},{key:"setLoading",value:function(t){if(this.viewport="viewport"==t,!this.viewport)return this.observer&&this.observer.disconnect(),void delete this.isIntersecting;this.observer=new IntersectionObserver(this.intersectionHandler.bind(this)),this.observer.observe(this.el)}},{key:"setUrl",value:function(t){this.finished=!1,this.cancelling=!1,this.viewport&&!this.isIntersecting||(this.attrs[this.urlAttribute]=t)}}]),n}(N);function _t(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=D(t);if(e){var i=D(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return I(this,n)}}n(ht,"matches","[url],[urlset]"),n(ht,"booleanAttributes",["hidden-error"]);var ft=function(t){H(n,t);var e=_t(n);function n(){return u(this,n),e.apply(this,arguments)}return h(n,null,[{key:"define",value:function(){Ft.component("iframe",this)}}]),n}(ht);function pt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=D(t);if(e){var i=D(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return I(this,n)}}var vt=function(t){H(n,t);var e=pt(n);function n(){return u(this,n),e.apply(this,arguments)}return h(n,null,[{key:"define",value:function(){Ft.component("img",this)}}]),n}(ht);function dt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=D(t);if(e){var i=D(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return I(this,n)}}var yt=function(t){H(n,t);var e=dt(n);function n(){return u(this,n),e.apply(this,arguments)}return h(n,null,[{key:"define",value:function(){Ft.component("embed",this)}}]),n}(ht);function mt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=D(t);if(e){var i=D(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return I(this,n)}}var gt=function(t){H(n,t);var e=mt(n);function n(){return u(this,n),e.apply(this,arguments)}return h(n,null,[{key:"define",value:function(){Ft.component("audio",this)}}]),n}(ht);function bt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=D(t);if(e){var i=D(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return I(this,n)}}var kt=function(t){H(n,t);var e=bt(n);function n(){return u(this,n),e.apply(this,arguments)}return h(n,null,[{key:"define",value:function(){Ft.component("video",this)}}]),n}(ht);function wt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=D(t);if(e){var i=D(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return I(this,n)}}var Ot=function(t){H(n,t);var e=wt(n);function n(){return u(this,n),e.apply(this,arguments)}return h(n,null,[{key:"define",value:function(){Ft.component("track",this)}}]),n}(ht);function Pt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=D(t);if(e){var i=D(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return I(this,n)}}var At=function(t){H(n,t);var e=Pt(n);function n(){return u(this,n),e.apply(this,arguments)}return h(n,null,[{key:"define",value:function(){Ft.component("source",this)}}]),n}(ht);function St(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=D(t);if(e){var i=D(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return I(this,n)}}var jt=function(t){H(n,t);var e=St(n);function n(){var t;u(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))).urlAttribute="data",t}return h(n,null,[{key:"define",value:function(){Ft.component("object",this)}}]),n}(ht);function Rt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=D(t);if(e){var i=D(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return I(this,n)}}var Et=function(t){H(n,t);var e=Rt(n);function n(){var t;u(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))).el.innerHTML="",t}return h(n,[{key:"setTransition",value:function(t){var e=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=t.path.state,i=function t(e){return e.parent?e.parent.component?e.parent.component.__scope.__transition.path:t(e.parent):null},o=function(t){e.empty();var n="component";if(r.component){var i=!1;for(var o in Ft.__components){if(Ft.__components[o]===r.component){n=o,i=!0;break}}if(!i)throw new Error('Router state "'.concat(r.name,'" has no defined component'))}return e.el.innerHTML="<".concat(n,">").concat(t,"</").concat(n,">"),Ft.compile(e.el,{recompile:!0})};return this.__scope.__transition={parent:i(t.path),state:t.path.state,data:t.path.data,url:t.path.url,params:t.path.params,query:t.path.query,hash:t.path.hash},n?Promise.resolve().then((function(){return r.template?r.template:r.templateUrl?P.get(r.templateUrl).then((function(t){return t.data})):void 0})).then((function(t){return o(t)})):Ft.compile(this.el,{recompile:{checkChanges:!0}})}}],[{key:"define",value:function(){Ft.component("route",this)}}]),n}(N);function Lt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Bt(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Lt(Object(r),!0).forEach((function(e){n(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Lt(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var xt=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;u(this,t),this.url=e,this.previous=n,this.path=null,this.routes=[],this.states={},this.__cancelled=!1,this.__finished=!1}return h(t,[{key:"redirect",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return i=Bt(Bt({},this.path.options),i),this.cancel(),Ct.state.call(Ct,t,e,n,r,i)}},{key:"reload",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return r=Bt(Bt({},this.path.options),r),t=Bt(Bt({},this.path.params),t),e=Bt(Bt({},this.path.query),e),n=void 0===n?this.path.hash:n,this.redirect(this.path.state.name,t,e,n,r)}},{key:"setPath",value:function(t){t.parent=this.path||null,this.path=Bt({params:{},query:{}},t),this.routes.push(this.path),this.states[this.path.state.name]=this.path}},{key:"getRoute",value:function(t){for(var e=0,n=this.routes.length;e<n;e++){var r=this.routes[e];if(r.state===t)return r}return null}},{key:"hasState",value:function(t){return!!this.states[t.name]}},{key:"isRouteChanged",value:function(t){if(!this.previous)return!0;var e=t.state;if(!this.previous.hasState(e))return!0;var n=[];for(var r in e.fullPattern.replace(Ct.__paramRegex,(function(t,e,r){return n.push(r)})),e.params)-1==n.indexOf(r)&&n.push(r);var i=Object.keys(e.query),o=void 0!==e.hash,a=this.previous.getRoute(e),s={params:m.includeKeys(a.params,n),query:m.includeKeys(a.query,i)},l={params:m.includeKeys(t.params,n),query:m.includeKeys(t.query,i)};return o&&(s.hash=a.hash,l.hash=t.hash),!m.compare(s,l)}},{key:"cancel",value:function(){this.__cancelled=!0,this.finish()}},{key:"finish",value:function(){this.__finished=!0,delete this.previous;var t=Ct.__queue.indexOf(this);t>=0&&Ct.__queue.splice(t,1)}}]),t}(),Ct={baseUrl:"/",states:[],hashMode:!0,transition:null,__info:{},__queue:[],__redirects:0,__init:!1,__paramRegex:/(\/?:([\w\d-]+))/g,__routeSelector:function(t){return t instanceof Et},add:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if("object"==r(t)&&(e=(n=t).pattern,t=n.state,delete n.pattern,delete n.state),!t)throw new Error("Router state must have a name");var i={template:"",templateUrl:"",abstract:!1,component:null,params:{},query:{},handler:function(){},options:{}};if(Ft.options.debug&&n.component&&(n.template||n.templateUrl)&&console.warn('Router state "'.concat(t,'" must only have a component or template option')),n.template||n.templateUrl||n.component||(n.abstract=!0),this.has(t))throw new Error('Router state "'.concat(t,'" is already exists'));return this.setState(t,e,Bt(Bt({},i),n)),this},remove:function(t){for(var e=0,n=this.states.length;e<n;e++)if(this.states[e].name==t)return void this.states.splice(e,1)},has:function(t){for(var e=0,n=this.states.length;e<n;e++)if(this.states[e].name==t)return!0;return!1},state:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};if("object"!==r(t)&&(t=this.getState(t)),!t)throw new Error("Not found route state with name ".concat(t));(a=Bt({},a)).manual=!0;var s=this.prepareStateArgs(t,n,i,o,a,!1);n=s.params,i=s.query,o=s.hash,a=s.options;var l=this.createStateUrl(t,n,i,o,a);return this.isolate((function(){return e.setUrl(l)})),this.changeState(a)},back:function(){return window.history.back.apply(window.history,arguments)},go:function(){return window.history.go.apply(window.history,arguments)},forward:function(){return window.history.forward.apply(window.history,arguments)},location:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(n=Bt({},n)).manual=!0,this.isolate((function(){return e.setUrl(t)})),this.changeState(n)},init:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=window.history.pushState;window.history.pushState=function(){var t=r.apply(this,arguments);return Ct.changeState().catch((function(t){return console.error(t)})),t},this.__onStateChangeHandler=function(){t.changeState().catch((function(t){return console.error(t)}))},this.defaultUrl=e,this.hashMode=n,this.states.sort((function(t,e){return(t=t.name.split(".").length)-(e=e.name.split(".").length)}));for(var i=0,o=this.states.length;i<o;i++)this.initState(this.states[i]);!this.states.length&&Ft.options.debug&&console.warn("You didn't add any routes to the router"),window.addEventListener("popstate",this.__onStateChangeHandler),this.__init=!0},initState:function(t){var e=[];if(t.children=[],(e=t.name.split(".")).pop(),t.level=t.abstract?null:e.length,e.length){var n=e.join("."),r=this.getState(n);if(!r)throw new Error('Not found parent route state "'.concat(n,'" for "').concat(t.name,'"'));null!==t.level&&r.abstract&&t.level--,t.fullPattern=this.splitSlashes(r.fullPattern+"/"+t.pattern),r.children.push(t)}else t.fullPattern=t.pattern},getState:function(t){for(var e=0,n=this.states.length;e<n;e++){var r=this.states[e];if(r.name==t)return r}return null},setState:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=Bt(Bt({},n),{},{name:t,pattern:e});return this.states.push(r),this.__init&&this.initState(r),r},removeState:function(t){for(var e=0,n=this.states.length;e<n;e++){if(this.states[e].name==t)return void this.states.splice(e,1)}},setUrl:function(t){this.hashMode?this.setHashUrl(t):this.setHistoryUrl(t)},setHistoryUrl:function(t){window.history.pushState(void 0,void 0,t)},setHashUrl:function(t){window.location.hash="#"+(t||"/")},replaceUrl:function(t){this.hashMode?this.replaceHashUrl(t):this.replaceHistoryUrl(t)},replaceHistoryUrl:function(t){window.history.replaceState(void 0,void 0,t)},replaceHashUrl:function(t){window.history.replaceState(void 0,void 0,"#"+(t||"/"))},getUrl:function(){return this.hashMode?this.getHashUrl():this.getHistoryUrl()},getHistoryUrl:function(){return window.location.pathname+window.location.search+window.location.hash},getHashUrl:function(){return window.location.hash.replace(/^#/,"")},getUrlQuery:function(){return this.hashMode?this.getHashUrlQuery():this.getHistoryUrlQuery()},getHistoryUrlQuery:function(){return P.paramsFromQuery(window.location.search.replace(/^\?/,""))},getHashUrlQuery:function(){return P.paramsFromQuery(window.location.hash.split("?")[1]||"")},createStateUrl:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];if("object"!==r(t)&&(t=this.getState(t)),o=Bt({},o),a){var s=this.prepareStateArgs(t,e,n,i,o);e=s.params,n=s.query,i=s.hash,o=s.options}var l=t.fullPattern.replace(this.__paramRegex,(function(t,n,r){return"/"+(e[r]||"")}));return l=l.replace(/^\^/,""),l=this.splitSlashes(l),Object.keys(n).length&&(l+="?"+P.paramsToQuery(n)),!this.hashMode&&i&&(l+="#"+i.replace("#","")),l},prepareStateArgs:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},o={params:e,query:n,hash:r,options:i},a=0;a<4^4;a++){var s=this.prepareStateParams(t,e,o),l=this.prepareStateQuery(t,n,o),u=this.prepareStateHash(t,r,o),c=this.prepareStateOptions(t,i,o);null===u?c.emptyHash=null:""===u&&(c.emptyHash="");var h={params:s,query:l,hash:u,options:c};if(m.compare(h,o))break;o=h}return o},prepareStateParams:function(t,e,n){"object"!==r(t)&&(t=this.getState(t));var i=t.name.split(".");e=Object.assign({},e);for(var o=i.length-1;o>=0;o--){var a=i.slice(0,i.length-o).join(".");e=this.createStateObjectArgs(e,this.getState(a).params,n)}return e},prepareStateQuery:function(t,e,n){"object"!==r(t)&&(t=this.getState(t));var i=t.name.split(".");e=Object.assign({},e);for(var o=i.length-1;o>=0;o--){var a=i.slice(0,i.length-o).join(".");e=this.createStateObjectArgs(e,this.getState(a).query,n)}return e},prepareStateOptions:function(t,e,n){"object"!==r(t)&&(t=this.getState(t));var i=t.name.split(".");e=Object.assign({},e);for(var o=i.length-1;o>=0;o--){var a=i.slice(0,i.length-o).join(".");e=this.createStateObjectArgs(e,this.getState(a).options,n)}return e},createStateObjectArgs:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{params:{},query:{},options:{}},r=Object.assign({},t);for(var i in e){var o=e[i];null!==r[i]&&("function"==typeof o&&(r[i]=o(n)),void 0===r[i]&&(r[i]=o))}for(var a in r)null===r[a]&&delete r[a];return r},prepareStateHash:function(t,e,n){if(null===e)return e;"object"!==r(t)&&(t=this.getState(t));for(var i=t.name.split("."),o=i.length-1;o>=0;o--){var a=i.slice(0,i.length-o).join(".");e=this.createStateHashArgs(e,this.getState(a).hash,n)}return e},createStateHashArgs:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{params:{},query:{}};return null===t?t:"function"==typeof e?e(n):void 0===t?e:t},splitSlashes:function(t){return t.replace(/[/]+/g,"/")},getPatternContent:function(t,e){"object"!==r(t)&&(t=this.getState(t));var n=[],i={};e=(e=e.split("?")[0]).split("#")[0];var o=t.fullPattern.replace(this.__paramRegex,(function(t,e,r){return n.push(r),"/?([^/]*)"}));o=o.replace(/([^^/]+)[/]+$/,"$1");var a=new RegExp(o,"g");return e.match(a)?(e.replace(a,(function(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),o=1;o<e;o++)r[o-1]=arguments[o];for(var a=0,s=(r=r.slice(0,r.length-2)).length;a<s;a++){var l=r[a];l&&(i[n[a]]=l)}})),{params:i}):null},isActiveState:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];"object"!==r(t)&&(t=this.getState(t));var n=Ct.transition&&!Ct.transition.__finished?Ct.transition.url:this.getUrl();n=this.splitSlashes("/"+n.split("?")[0]+"/");var i=t.fullPattern.replace(this.__paramRegex,"/?([^/]*)");i=i.replace(/^\^/,"").replace(/\$$/,"");var o=e?i:this.splitSlashes("^/"+i+"/$"),a=new RegExp(o);return a.test(n)},inActiveState:function(t){return Ct.isActiveState(t,!0)},getRoute:function(t){var e=this,n=0;return function r(i){var o=i.child(e.__routeSelector);return o?n==t?o:(n++,r(o)):null}(Ft.root)},getArrayPatternContent:function(t,e){for(var n=0,r=t.length;n<r;n++){var i=t[n],o=this.getPatternContent(i,e);if(o)return Bt({state:i},o)}return null},getStatesByLevel:function(t){for(var e=[],n=0,r=this.states.length;n<r;n++){var i=this.states[n];if(!(i.level<t)){if(i.level>t)break;e.push(i)}}return e},reload:function(){var t;if(!this.transition)throw new Error("Not found an active transition to reload the state");return(t=this.transition).reload.apply(t,arguments)},isolate:function(t){var e;this.__isolated=!0;try{e=t()}catch(t){throw this.__isolated=!1,t}return this.__isolated=!1,e},changeState:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.__isolated)return Promise.resolve();var n=this.getUrl(),r=new xt(n);return this.__queue.push(r),new Promise((function(e){var n=setInterval((function(){t.__queue[0]===r&&(clearInterval(n),e())}))})).then((function(){r.previous=Ct.transition||null,Ct.transition=r,window.dispatchEvent(new CustomEvent("state-change",{detail:r}));var i=e.emptyHash;if(!t.__redirects){var o=getComputedStyle(document.documentElement);t.__info.scrollPos={left:window.scrollX,top:window.scrollY},t.__info.docMinHeight=o.minHeight,t.__info.docMinWidth=o.minWidth,document.documentElement.style.minHeight=document.documentElement.offsetHeight+"px",document.documentElement.style.minWidth=document.documentElement.offsetWidth+"px"}var a={},s=t.getUrlQuery(),l=t.hashMode?"":window.location.hash.replace("#",""),u=0;return function o(c){if(!c.length)return Promise.resolve();var h=t.getArrayPatternContent(c,n);if(!h)return Promise.resolve();var _=h.state;r.setPath({state:_,component:v}),a=Bt(Bt({},a),h.params),l=l||i;var f=t.prepareStateArgs(_,a,s,l,e);a=f.params,s=f.query,l=f.hash,(e=f.options).init=null===Ft.__init,l=l||"";var p=t.createStateUrl(_,a,s,l,e,!1);t.isolate((function(){return t.replaceUrl(p)}));var v=_.abstract?null:t.getRoute(u);if(!v&&!_.abstract)throw new Error('Not found route component for state "'.concat(_.name,'"'));r.path.params=a,r.path.query=s,r.path.hash=l,r.path.url=p,r.path.options=e,!_.abstract&&u++;var d=!0;p!=n&&(d=r.isRouteChanged(r.path));var y=d&&!1!==e.reload,m=r.previous&&r.previous.path?r.previous.path.data:void 0;return Promise.resolve(y?_.handler(r):m).then((function(t){if(r.path.data=t,_.title&&(document.title="function"==typeof _.title?_.title(r):_.title),!r.__cancelled&&!_.abstract){var e=r.previous&&r.previous.getRoute(_);return e&&!e.loaded&&(y=!0),v.setTransition(r,y).then((function(){return r.path.loaded=!0}))}})).then((function(){return o(_.children)}))}(t.getStatesByLevel(0)).then((function(){if(!r.routes.length){if(t.__redirects)throw new Error('Wrong router default url "'.concat(t.defaultUrl,'"'));if(t.defaultUrl){if(t.defaultUrl==t.getUrl())throw new Error("Not found any routes");return t.isolate((function(){return t.replaceUrl(t.defaultUrl)})),t.__redirects++,r.finish(),t.changeState(e)}Ft.options.debug&&console.warn('Not found a default route. You can pass it in "router.init(defaultUrl)" function')}return!t.hashMode&&r.path&&r.path.hash||window.scrollTo(Bt({},e.saveScrollPosition?t.__info.scrollPos:{top:0,left:0})),document.documentElement.style.minHeight=t.__info.docMinHeight,document.documentElement.style.minWidth=t.__info.docMinWidth,t.__redirects=0,t.__info={},window.dispatchEvent(new CustomEvent("state-changed",{detail:r})),r.finish(),r}))})).catch((function(t){throw r&&r.finish(),t}))},deinit:function(){window.removeEventListener("popstate",this.__onStateChangeHandler),this.__init=!1}};Ct.Transition=xt;const Tt=Ct;function Kt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=D(t);if(e){var i=D(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return I(this,n)}}var Nt=function(t){H(n,t);var e=Kt(n);function n(){var t;u(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))).state=null,t.params={},t.query={},t.options={},t.isUrl=t.el.hasAttribute("url"),t}return h(n,[{key:"compiled",value:function(){var t=this;this.el.addEventListener("click",(function(e){e.preventDefault(),t.isUrl?Tt.location(t.attrs.url,t.options):Tt.state(t.state.name,t.params,t.query,t.hash,t.options)})),this.onStateChanged=function(){return t.state&&t.setActivity()},window.addEventListener("state-changed",this.onStateChanged),this.attr("state",this.setState),this.attr("params",this.setParams),this.attr("query",this.setQuery),this.attr("hash",this.setHash),this.attr("options",this.setOptions),this.attr("url",this.setUrl),this.attr("state",this.resetHref,{callOnStart:!1}),this.attr("params",this.resetHref,{callOnStart:!1}),this.attr("query",this.resetHref,{callOnStart:!1}),this.attr("hash",this.resetHref,{callOnStart:!1}),this.attr("url",this.resetHref,{callOnStart:!1}),this.resetHref()}},{key:"removed",value:function(){window.removeEventListener("state-changed",this.onStateChanged)}},{key:"setUrl",value:function(t){this.url=t}},{key:"setState",value:function(t){this.state=this.getState(t),this.setActivity()}},{key:"setActivity",value:function(){this.scope.isActiveState=Tt.isActiveState(this.state),this.scope.inActiveState=Tt.inActiveState(this.state)}},{key:"setParams",value:function(t){if("object"!=r(t)||!t)throw new Error("Router state params must be an object");this.params=t}},{key:"setQuery",value:function(t){if("object"!=r(t)||!t)throw new Error("Router state query must be an object");this.query=t}},{key:"setHash",value:function(t){if("string"!=typeof t&&null!=t)throw new Error("Router state hash must be a string|null");this.hash=t}},{key:"setOptions",value:function(t){if("object"!=r(t)||!t)throw new Error("Router state options must be an object");this.options=t}},{key:"getState",value:function(t){var e=Tt.getState(t);if(!e)throw new Error('Not found router state with name "'.concat(t,'"'));return e}},{key:"resetHref",value:function(){this.url?this.attrs.href=this.url:this.attrs.href=Tt.createStateUrl(this.state,this.params,this.query,this.hash,this.options)}}],[{key:"define",value:function(){Ft.component("a",this)}}]),n}(N);function Ht(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=D(t);if(e){var i=D(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return I(this,n)}}n(Nt,"matches","[state]:not([url]),[url]:not([state])"),n(Nt,"controlAttributes",!0);var It=function(t){H(n,t);var e=Ht(n);function n(){var t;u(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))).prevent(),t}return h(n,null,[{key:"define",value:function(){Ft.component("script",this)}}]),n}(N);function Dt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=D(t);if(e){var i=D(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return I(this,n)}}var Ut=function(t){H(n,t);var e=Dt(n);function n(){var t;u(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))).prevent(),t}return h(n,null,[{key:"define",value:function(){Ft.component("style",this)}}]),n}(N);function Mt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Vt(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Mt(Object(r),!0).forEach((function(e){n(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Mt(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var qt={options:{debug:!0},__init:null,__root:null,__components:{},__aliases:{},__scopes:{},__storeLinks:{},__window:{},__tags:{},__isolation:null,__evaluation:null,__wrapping:!1,__disableStoreProxy:!1,__rootOuterHTML:"",__onError:function(){return qt.triggerInit(!1)},htmlBooleanAttributes:["disabled","contenteditable","hidden"],components:{},services:{}};qt.Component=N,qt.EventEmitter=p,qt.Scope=g,qt.utils=m,qt.globals=L,qt.components.A=Nt,qt.components.Audio=gt,qt.components.Content=st,qt.components.For=$,qt.components.Embed=yt,qt.components.If=M,qt.components.Include=ut,qt.components.Input=tt,qt.components.Iframe=ft,qt.components.Image=vt,qt.components.Object=jt,qt.components.Radio=nt,qt.components.Route=Et,qt.components.Select=G,qt.components.Source=At,qt.components.Text=J,qt.components.Textarea=ot,qt.components.Track=Ot,qt.components.Url=ht,qt.components.Video=kt,qt.components.Script=It,qt.components.Style=Ut,qt.services.request=P,qt.services.router=Tt,qt.services.store=R,qt.define=function(){Nt.define(),gt.define(),st.define(),N.define(),yt.define(),$.define(),ut.define(),ft.define(),vt.define(),tt.define(),M.define(),jt.define(),nt.define(),Et.define(),G.define(),At.define(),ot.define(),Ot.define(),kt.define(),It.define(),Ut.define()},qt.clearGlobals=function(){for(var t in L)delete L[t];for(var e in this.__window.Element.prototype)Element.prototype[e]=this.__window.Element.prototype[e];for(var n in this.__window.Array.prototype)Array.prototype[n]=this.__window.Array.prototype[n];for(var r in this.options.globals)this.options.globals[r]=this.unwrap(this.options.globals[r]);window.setTimeout=this.__window.setTimeout,window.setInterval=this.__window.setInterval,window.Promise=this.__window.Promise,window.removeEventListener("error",this.__onError)},qt.joinBindingKeys=function(t){return t.map((function(t){return t.toString()})).join(".")},qt.addScope=function(t){if(this.__scopes[t.__name])throw new Error("Scope name ".concat(t.__name," already exists"));this.__scopes[t.__name]=t},qt.getScope=function(t){return this.__scopes[t]},qt.removeScope=function(t){delete this.__scopes[t]},qt.getAkiliParents=function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=[];function r(t){t.parentNode&&(t.parentNode.__akili&&(n.push(t.parentNode),!e)||r(t.parentNode))}return r(t),e?n:n[0]},qt.setTemplate=function(t,e){return e=e.replace(/\${(((?!\${)\s*this\.__content\s*)*)}/,t.innerHTML),t.innerHTML=e,t.innerHTML},qt.createScopeName=function(){var t=this;return m.createRandomString(16,(function(e){return!!t.__scopes[e]}))},qt.isolate=function(t){var e,n=this.__isolation;!n&&(this.__isolation={});try{if(e=t(),n)return e}catch(t){throw this.__isolation=null,t}var r=[];for(var i in this.__isolation)r.push(this.__isolation[i]);this.__isolation=null;for(var o=0,a=r.length;o<a;o++){var s=r[o];if(s.component)s.component.__isRemoved||(s.component.scope[s.rootKey]=m.getPropertyByKeys(s.rootKeys,s.component.__scope));else{var l=m.copy(m.getPropertyByKeys(s.rootKeys,R.__target),{plain:!0});this.root&&this.root.__storeTriggerByName(s.rootKey,l)}}return e},qt.unevaluate=function(t){var e,n=this.__evaluation;this.__evaluation=null;try{e=t()}catch(t){throw this.__evaluation=n,t}return this.__evaluation=n,e},qt.wrapping=function(t){var e,n=this.__wrapping;!n&&(this.__wrapping=!0);try{if(e=this.isolate(t),n)return e}catch(t){throw this.__wrapping=!1,t}return this.__wrapping=!1,e},qt.unisolate=function(t){var e,n=this.__isolation;this.__isolation=null;try{e=t()}catch(t){throw this.__isolation=n,t}return this.__isolation=n,e},qt.initialize=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.recompile,r=t.__akili;if(r)return n?(r.__recompile(!0===n?{}:n),r):void 0;var i=t===this.__root,o=m.toDashCase(t.getAttribute("component")||t.tagName.toLowerCase()),a=this.__components[o];t:if(!a){var s=Object.keys(this.__aliases);if(!s.length)break t;var l=s.join(",");if(!t.matches(l))break t;for(var u=0,c=s.length;u<c;u++){var h=s[u];if(t.matches(h)){a=this.__components[this.__aliases[h]];break}}}return!a&&!i||(a||(a=this.Component),a.matches&&!t.matches(a.matches)||(r=new a(t,{})).__cancelled||qt.getAkiliParents(t).find((function(t){return t.__akili.__prevent})))?void 0:(r.__create(),r)},qt.compile=function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{recompile:!1},r=[];if(window.AKILI_SSR)for(var i=t.querySelectorAll("[no-ssr]"),o=0,a=i.length;o<a;o++)i[o].remove();var s=function t(i){var o=e.initialize(i,n),a=i.children;o&&r.push(o);for(var s=0,l=a.length;s<l;s++){t(a[s])}};s(t);for(var l=[],u=0,c=r.length;u<c;u++){var h=r[u];l.push(h.__compile())}return Promise.all(l).then((function(){for(var t=[],e=r.length-1;e>=0;e--){var n=r[e];t.push(n.__resolve())}return Promise.all(t)}))},qt.component=function(t,e){if(t=t.toLowerCase(),!e)return this.__components[t]||null;this.__components[t]&&qt.options.debug&&console.warn("Component ".concat(t," already was added")),this.__components[t]=e},qt.removeComponent=function(t){delete this.__components[t]},qt.alias=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(!(e=e.toLowerCase()))return this.__aliases[t]||null;this.__aliases[t]&&qt.options.debug&&console.warn("Alias with selector ".concat(t," already was added")),this.__aliases[t]=e},qt.removeAlias=function(t){delete this.__aliases[t]},qt.isolateArrayPrototype=function(){var t=this;this.__window.Array={prototype:{}};for(var e=Object.getOwnPropertyNames(Array.prototype),n=function(n,r){var i=e[n],o=Array.prototype[i];if("function"!=typeof o||"constructor"==i)return"continue";t.__window.Array.prototype[i]=o,Array.prototype[i]=function(){var t=arguments,e=this;return qt.unevaluate((function(){return e.__isProxy?qt.isolate((function(){return o.apply(e,t)})):o.apply(e,t)}))}},r=0,i=e.length;r<i;r++)n(r)},qt.isolateWindowFunctions=function(){this.__window.setTimeout=setTimeout,this.__window.setInterval=setInterval,this.__window.Promise=window.Promise,window.setTimeout=this.createCallbackIsolation(window.setTimeout,0),window.setInterval=this.createCallbackIsolation(window.setInterval,0),window.AKILI_SSR||(window.Promise.constructor=this.createCallbackIsolation(window.Promise.constructor),window.Promise.prototype.then=this.createCallbackIsolation(window.Promise.prototype.then,[0,"last"]),window.Promise.prototype.catch=this.createCallbackIsolation(window.Promise.prototype.catch))},qt.isolateGlobals=function(){L.__target.utils=this.wrap(m),this.isolateEvents(),this.isolateArrayPrototype(),this.isolateWindowFunctions()},qt.isolateEvents=function(){this.__window.Element={prototype:{}},window.AKILI_SSR||(this.__window.Element.prototype.addEventListener=Element.prototype.addEventListener,this.__window.Element.prototype.removeEventListener=Element.prototype.removeEventListener,this.__window.Element.prototype.remove=Element.prototype.remove,Element.prototype.remove=function(){return delete this.__akiliListeners,qt.__window.Element.prototype.remove.apply(this,arguments)},Element.prototype.addEventListener=function(t,e){var n=[].slice.call(arguments);return this.__akiliListeners||(this.__akiliListeners={}),this.__akiliListeners[t]||(this.__akiliListeners[t]=[]),"function"==typeof e&&(n[1]=function(){var t=arguments,n=this;return qt.isolate((function(){return e.apply(n,t)}))}),this.__akiliListeners[t].push({link:e,fn:n[1]}),qt.__window.Element.prototype.addEventListener.apply(this,n)},Element.prototype.removeEventListener=function(t,e){var n=[].slice.call(arguments);this.__akiliListeners||(this.__akiliListeners={}),this.__akiliListeners[t]||(this.__akiliListeners[t]=[]);for(var r=0,i=this.__akiliListeners[t].length;r<i;r++){var o=this.__akiliListeners[t][r];if(o.link===e){this.__akiliListeners[t].splice(r,1),n[1]=o.fn,r--,i--;break}}return this.__akiliListeners[t].length||delete this.__akiliListeners[t],qt.__window.Element.prototype.removeEventListener.apply(this,n)})},qt.createCallbackIsolation=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"last";return function(){var n=[].slice.call(arguments);!Array.isArray(e)&&(e=[e]);for(var r=function(t,r){var i=e[t],o=i,a=n[i];if("last"==i&&(o=n.length-1,a=n[o]),"function"!=typeof a)return"continue";a.__isolated||(n[o]=function(){var t=arguments;return qt.isolate((function(){return a.apply(a,t)}))},Object.defineProperty(n[o],"__isolated",{enumerable:!1,value:a}))},i=0,o=e.length;i<o;i++)r(i,o);return t.apply(this,n)}},qt.wrap=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t;if("function"==typeof t){if((t=this.wrapFunction(t,e))===n)return t}else if(!t||"object"!=r(t)||Array.isArray(t))return t;for(var i=Object.getOwnPropertyNames(t),o=0,a=i.length;o<a;o++){var s=i[o],l=Object.getOwnPropertyDescriptor(t,s);l.configurable&&l.writable&&(e.reverse?Object.defineProperty(t,s,Vt(Vt({},l),{},{value:t[s].__akili||t[s]})):Object.defineProperty(t,s,Vt(Vt({},l),{},{value:this.wrap(t[s],e)})))}return t},qt.unwrap=function(t){return this.wrap(t,{reverse:!0})},qt.wrapFunction=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t.__akili)return t;var n=function(){var n=arguments,r=this;return e.tag&&qt.__evaluation&&qt.addTag(e.tag,qt.__evaluation.node),qt.wrapping((function(){return t.apply(r,n)}))},r=Object.keys(t);n.prototype=t.prototype;for(var i=0,o=r.length;i<o;i++){var a=r[i];n[a]=t[a]}return Object.defineProperty(n,"__akili",{enumerable:!1,value:t}),n},qt.addTag=function(t,e){this.hasTag(t,e)||(this.__tags[e.__name]||(this.__tags[e.__name]={}),this.__tags[e.__name][t]||(this.__tags[e.__name][t]=[]),this.__tags[e.__name][t].push({node:e}))},qt.getTag=function(t,e){if(!e){for(var n in this.__tags)for(var r in this.__tags[n])if(r==t)return this.__tags[n][r];return null}return this.__tags[e.__name]&&this.__tags[e.__name][t]?this.__tags[e.__name][t]:null},qt.hasTag=function(t,e){return!!this.getTag(t,e)},qt.removeTag=function(t,e){if("object"==r(t)&&(e=t,t=void 0),t)if(e){for(var n in this.__tags[e.__name])n==t&&delete this.__tags[e.__name][n];Object.keys(this.__tags[e.__name]).length||delete this.__tags[e.__name]}else for(var i in this.__tags){for(var o in this.__tags[i])o==t&&delete this.__tags[i][o];Object.keys(this.__tags[i]).length||delete this.__tags[i]}else delete this.__tags[e.__name]},qt.triggerTag=function(t){for(var e in this.__tags)for(var n in this.__tags[e])if(n==t)for(var r=this.__tags[e][n],i=0,o=r.length;i<o;i++){var a=r[i];a.node.__component.__evaluateNode(a.node,!1)}},qt.handleErrors=function(){window.addEventListener("error",this.__onError)},qt.triggerInit=function(t){qt.__init=t,window.dispatchEvent(new CustomEvent("akili-init",{detail:t}))},qt.init=function(t){var e=this;if(t=t||document.body,this.__rootOuterHTML=t.outerHTML,!(t instanceof Element))throw new Error("Root element must be an html element");if(t===document.documentElement)throw new Error('"html" can\'t be the root element');return this.__root=t,window.AKILI_SERVER?(qt.initServerSideHtml(window.AKILI_SERVER.html),qt.initServerSideRequestCache(window.AKILI_SERVER.requestCache)):window.AKILI_CLIENT={html:this.prepareServerSideHtml()},this.compile(this.__root).then((function(){if(Tt.__init)return Tt.changeState()})).then((function(){window.AKILI_CLIENT&&(window.AKILI_CLIENT.requestCache=e.prepareServerSideRequestCache()),e.triggerInit(!0)})).catch((function(t){throw e.triggerInit(!1),t}))},qt.deinit=function(){for(var t in this.__root&&(this.__root.outerHTML=this.__rootOuterHTML),this.__scopes){var e=this.__scopes[t].__component;e&&e.remove()}this.__rootOuterHTML="",this.__init=null,this.__root=null,this.__scopes={},this.__storeLinks={},this.__tags={}},qt.destroy=function(){this.deinit(),this.clearGlobals();for(var t=Object.keys(R.__target),e=0,n=t.length;e<n;e++)delete R.__target[t[e]];for(var r in Tt.__init&&Tt.deinit(),delete window.AKILI_SERVER,delete window.AKILI_CLIENT,delete window.AKILI_SSR,qt)delete qt[r];delete window.Akili},qt.initServerSideHtml=function(t){for(var e=this.__root.attributes.length-1;e>=0;e--)this.__root.removeAttribute(this.__root.attributes[e].name);var n=(new DOMParser).parseFromString(t,"text/html").querySelector(this.__root===document.body?"body":"body > *");this.__root.innerHTML=n.innerHTML;for(var r=n.attributes.length-1;r>=0;r--){var i=n.attributes[r];this.__root.setAttribute(i.name,i.value)}},qt.initServerSideRequestCache=function(t){var e=function(t,e){for(var n in e)t.__cache[n]=e[n]};for(var n in t){e("__main"===n?P:P.__instances[n],t[n])}},qt.prepareServerSideHtml=function(){return this.__root.outerHTML},qt.prepareServerSideRequestCache=function(){var t={__main:P.__cache};for(var e in P.__instances)t[e]=P.__instances[e].__cache;return t};const Ft=qt;return window.Akili=qt,qt.define(),qt.handleErrors(),qt.isolateGlobals(),e=e.default})()}));